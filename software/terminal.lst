                        
   0000                 DMA_REG EQU 0
   0001                 INTP_REG EQU 1
   0002                 INTX_REG EQU 2
   0003                 PC_REG EQU 3
   0004                 R4 EQU 4
   0005                 R5 EQU 5
   0006                 R6 EQU 6
   0007                 R7 EQU 7
   0008                 R8 EQU 8
   0009                 R9 EQU 9
   000a                 R10 EQU 10
   000b                 R11 EQU 11
   000c                 R12 EQU 12
   000d                 CALL_REG EQU 13
   000e                 FCALL_REG EQU 14
   000e                 RETURN EQU 14
   000f                 STACK_REG EQU 15
                        
   ffff                 STACK_ADDRESS EQU 0FFFFh
   3000                 DMA_ADDRESS EQU 03000h
                        
   2000                 INPUT_BUFF EQU 02000h
                        
   2100                 VARLIST_COUNT EQU 02100h
   2102                 VARLIST_FIRSTNODE EQU 02102h
   2104                 VARLIST_LASTNODE EQU 02104h
                        
   2106                 HEAP_LASTADDRESS EQU 02106h
   2110                 HEAP_START EQU 02110h
   fc00                 HEAP_END EQU 0FC00h
                        
                        
   0000                     org 00h
                        
   0000                 START
   0000   71                dis
   0001   00                idl
                            
   0002   7b                seq     ;set Q output to high
                            
   0003   f8 ff             ldi STACK_ADDRESS.0 ;setup the STACK pointer
   0005   af                plo STACK_REG
   0006   f8 ff             ldi STACK_ADDRESS.1
   0008   bf                phi STACK_REG
                            
   0009   f8 01             ldi FCALL.1         ;setup FCALL
   000b   be                phi FCALL_REG
                            
   000c   f8 13             ldi DMA_INIT.0      ;switch PC to R3 and init DMA
   000e   a3                plo PC_REG
   000f   f8 00             ldi DMA_INIT.1
   0011   b3                phi PC_REG
                            
   0012   d3                sep PC_REG
                            
   0013                 DMA_INIT
   0013   f8 00             ldi DMA_ADDRESS.0   ;setup DMA address
   0015   a0                plo DMA_REG
   0016   f8 30             ldi DMA_ADDRESS.1
   0018   b0                phi DMA_REG
                            
   0019   c0 14 83          lbr MAIN_PROGRAM
                            
                        ;-FUNCTION CALL HELPER-------------------------
                        ;-WHERE TO JUMP-(CALL_REG)---------------------
   0100                     org 0100h
                            
   0100                 FCALL
   0100   ef                sex STACK_REG   ;set STACK as X register
   0101   93                ghi PC_REG      ;saving the PC value to stack
   0102   73                stxd
   0103   83                glo PC_REG
   0104   73                stxd
                            
   0105   8d                glo CALL_REG    ;put the new address in the PC
   0106   a3                plo PC_REG
   0107   9d                ghi CALL_REG
   0108   b3                phi PC_REG
   0109   d3                sep PC_REG      ;jumping to PC
                            
   010a                 FRETURN
   010a   1f                inc STACK_REG   ;increment the STACK register
   010b   ef                sex STACK_REG   ;set STACK as X register
   010c   72                ldxa            ;restoring PC from STACK
   010d   a3                plo PC_REG
   010e   f0                ldx
   010f   b3                phi PC_REG
   0110   d3                sep PC_REG      ;jumping to PC
   0111   30 0a             br FRETURN
                        ;----------------------------------------------
                        
                        ;-SERIAL SEND BYTE-----------------------------
                        ;-DATA-R4.1------------------------------------
   0113                 SERIAL_SEND_START
   0113   94                ghi R4      ;R4 high is the data, load it into the D reg
   0114   fb ff             xri 0FFh    ;invert it
   0116   b4                phi R4      ;put it back
   0117   f8 85             ldi 085h    ;load 0x85 to the D reg
   0119   fe                shl         ;shift it left so we get 0x0A and set the flag bit
   011a   a4                plo R4      ;put the 0x10 to R4 low, this will be our bit counter
                        
   011b                 SERIAL_SEND_BIT
   011b   c7                lsnf        ;24 - long skip if the flag is not set
   011c   7a                req         ;16 - reset Q if the flag is set
   011d   c8                lskp        ;24
   011e   7b                seq         ;16 - set Q if the flag is not set
   011f   c4                nop         ;24
                            
   0120   24                dec R4      ;16 - decrement R4, this will only affect the R4 lower 8bit
   0121   84                glo R4      ;16
   0122   c6                lsnz        ;24 - if R4 lower is not 0 then long skip
   0123   de                sep RETURN  ;--
   0124   c4                nop         ;--
   0125   94                ghi R4      ;16 - get R4 high
   0126   f6                shr         ;16 - shift it right to get LSB in the flag
   0127   b4                phi R4      ;16 - put it back
   0128   c4                nop         ;24
   0129   c4                nop         ;24
   012a   c4                nop         ;24
   012b   30 1b             br SERIAL_SEND_BIT ;16
                        ;----------------------------------------------
                        
                        ;-SERIAL READ BYTE-----------------------------
                        ;-RETURN R5.1----------------------------------
   012d                 SERIAL_READ_START
   012d   f8 00             ldi 00h     ;set input data register to 0
   012f   a5                plo R5
   0130   b5                phi R5
                            
   0131                 SERIAL_WAIT_START
   0131   3c 31             bn1 SERIAL_WAIT_START ;16 - loop until EF1 goes low
   0133   c4                nop         ;24
   0134   c4                nop         ;24
   0135   c4                nop         ;24
   0136   c4                nop         ;24
   0137   f9 00             ori 00h     ;16 - do nothing for 16 clock cycles
                        
   0139                 SERIAL_SAMPLE_BIT
   0139   34 3f             b1 SERIAL_NULL_BIT  ;16 - checking the EF1
   013b   f9 80             ori 080h            ;16 - if EF1 is high then set MSB to 1 in D register
   013d   30 43             br SERIAL_SAVE_BIT  ;16
                        
   013f                 SERIAL_NULL_BIT
   013f   f9 00             ori 00h         ;16 - of EF1 is low we do nothing
   0141   f9 00             ori 00h         ;16
                        
   0143                 SERIAL_SAVE_BIT
   0143   b5                phi R5          ;16 - put D in R5 high
   0144   15                inc R5          ;16 - increment R5, this will only affect R5 low 8bit
   0145   85                glo R5          ;16 - get R5 low to D register
   0146   fb 09             xri 09h         ;16 - D = D ^ 0x09
   0148   c6                lsnz            ;24 
   0149   de                sep RETURN      ;--
   014a   c4                nop             ;--
   014b   95                ghi R5          ;16 - get R5 high
   014c   f6                shr             ;16 - shift it righ
   014d   c4                nop             ;24
   014e   c4                nop             ;24
   014f   c4                nop             ;24
   0150   30 39             br SERIAL_SAMPLE_BIT ;16
                        ;----------------------------------------------
                        
                        ;-PRINT----------------------------------------
                        ;-FIRST CHAR-R6--------------------------------
   0152                 PRINT
   0152   e6                sex R6          ;set X register to R6
   0153   72                ldxa            ;load data to D and increment R6
   0154   c6                lsnz            ;if it is not zero then long skip
   0155   de                sep RETURN
   0156   c4                nop
                            
   0157   b4                phi R4          ;put D register to R4 to send it
                            
   0158   f8 13             ldi SERIAL_SEND_START.0     ;prepare to call SERIAL_SEND
   015a   ad                plo CALL_REG
   015b   f8 01             ldi SERIAL_SEND_START.1
   015d   bd                phi CALL_REG
                            
   015e   f8 00             ldi FCALL.0
   0160   ae                plo FCALL_REG
   0161   de                sep FCALL_REG   ;call SERIAL_SEND
   0162   30 52             br PRINT
                        ;----------------------------------------------
                        
   0164                 BACKSPACE_ACTION
   0164   08 20 08 00       db 8, 32, 8, 0
                        ;-READ LINE------------------------------------
                        ;-WHERE TO READ-R7-----------------------------
                        ;-R8.1-Character counter-------------------------
   0168                 READLINE
   0168   f8 00             ldi 0
   016a   a8                plo R8
                            
   016b                 READLINE_LOOP
   016b   f8 2d             ldi SERIAL_READ_START.0     ;prepare calling SERIAL_READ
   016d   ad                plo CALL_REG
   016e   f8 01             ldi SERIAL_READ_START.1
   0170   bd                phi CALL_REG
                            
   0171   f8 00             ldi FCALL.0
   0173   ae                plo FCALL_REG
   0174   de                sep FCALL_REG       ;call SERIAL_READ
                            
   0175   95                ghi R5              ;get the result of SERIAL_READ
   0176   fb 0d             xri 13              ;check if it is 13 (ENTER KEY)
   0178   3a 8e             bnz READLINE_BACKSPACE      ;if not jump to READLINE_BACKSPACE
                            
   017a                 END_LINE
   017a   f8 00             ldi 00h             ;put 0 to the endof the string
   017c   57                str R7
                            
   017d   f8 01             ldi NEW_LINE.0      ;load the address of CRLF string
   017f   a6                plo R6
   0180   f8 15             ldi NEW_LINE.1
   0182   b6                phi R6
                            
   0183   f8 52             ldi PRINT.0         ;prepare to call PRINT
   0185   ad                plo CALL_REG
   0186   f8 01             ldi PRINT.1
   0188   bd                phi CALL_REG
                            
   0189   f8 00             ldi FCALL.0
   018b   ae                plo FCALL_REG
   018c   de                sep FCALL_REG       ;call PRINT
                            
   018d   de                sep RETURN          ;RETURN from READLINE
                            
   018e                 READLINE_BACKSPACE
   018e   95                ghi R5              ;get the result of SERIAL_READ
   018f   fb 7f             xri 127             ;check if it is 127 (DEL)
   0191   3a aa             bnz STORE_CHAR      ;if not jump to STORE_CHAR
                            
   0193   88                glo R8
   0194   32 6b             bz READLINE_LOOP
                            
   0196   f8 64             ldi BACKSPACE_ACTION.0      ;load the address of the backspace action
   0198   a6                plo R6
   0199   f8 01             ldi BACKSPACE_ACTION.1
   019b   b6                phi R6
                            
   019c   f8 52             ldi PRINT.0                 ;prepare to call PRINT
   019e   ad                plo CALL_REG
   019f   f8 01             ldi PRINT.1
   01a1   bd                phi CALL_REG
                            
   01a2   f8 00             ldi FCALL.0
   01a4   ae                plo FCALL_REG
   01a5   de                sep FCALL_REG               ;call PRINT
                            
   01a6   27                dec R7
   01a7   28                dec R8
                            
   01a8   30 6b             br READLINE_LOOP
                            
   01aa                 STORE_CHAR
   01aa   88                glo R8
   01ab   fb ff             xri 0FFh
   01ad   32 6b             bz READLINE_LOOP
                            
   01af   95                ghi R5              ;get the result of the SERIAL_READ again
   01b0   57                str R7              ;store it where R7 pointing
   01b1   17                inc R7              ;increment R7
   01b2   18                inc R8
                            
   01b3   b4                phi R4              ;load the result to R4 to Echo it back
                            
   01b4   f8 13             ldi SERIAL_SEND_START.0     ;prepare to call SERIAL_SEND
   01b6   ad                plo CALL_REG
   01b7   f8 01             ldi SERIAL_SEND_START.1
   01b9   bd                phi CALL_REG
                            
   01ba   f8 00             ldi FCALL.0
   01bc   ae                plo FCALL_REG
   01bd   de                sep FCALL_REG       ;call SERIAL_SEND
   01be   30 6b             br READLINE_LOOP
                        ;----------------------------------------------
                        
                        ;-STR COMPARATOR-------------------------------
                        ;-R8 stringA-R9 stringB------------------------
                        ;-RETURN R10.0---------------------------------
   01c0                 STR_COMPARATOR
   01c0   f8 00             ldi 0           ;R10 low is the result, set it to 0
   01c2   aa                plo R10
                        	
   01c3                 STR_CHARCHECK
   01c3   08                ldn R8          ;load value from RAM[R8] to D register
   01c4   e9                sex R9          ;set X pointer to R9
   01c5   f3                xor             ;D = D ^ RAM[R9]
                            
   01c6   32 c9             bz STR_EQUAL    ;if D == 0 jump to STR_EQUAL
   01c8   de                sep RETURN      ;RETURN
                            
   01c9                 STR_EQUAL 
   01c9   08            	ldn R8          ;load value from RAM[R8] to D register again
   01ca   3a d0         	bnz STR_INC     ;if D != 0 jump to STR_INC
   01cc   f8 01         	ldi 1           ;set R10 to 1 and return
   01ce   aa            	plo R10
   01cf   de            	sep RETURN
                        	
   01d0                 STR_INC
   01d0   18            	inc R8          ;increment both address by 1
   01d1   19            	inc R9
   01d2   30 c3         	br STR_CHARCHECK
                        ;----------------------------------------------
                        
                        ;-INTEGER DIV----------------------------------
                        ;-R4 pointing to divident----------------------
                        ;-R5 pointing to divider-----------------------
                        ;-R6 pointing to quotient----------------------
                        ;-R7 pointing to remainder---------------------
                        ;-R8.0 bitcnt, R8.1 flags----------------------
                        ;-R9 general counter---------------------------
   01d4                 INTEGER_DIV
   01d4   ef                sex STACK_REG   ;set STACK_REG as data pointer to store variables in STACK
   01d5   f8 00             ldi 0           ;set bitcnt and flags to 0
   01d7   a8                plo R8
   01d8   b8                phi R8
                            
   01d9   15                inc R5          ;increment R5 to the MSB because we want to store the divider it in little-endian format
   01da   15                inc R5
   01db   15                inc R5
                            
   01dc   05                ldn R5          ;copying starts here
   01dd   73                stxd
   01de   25                dec R5
                            
   01df   05                ldn R5
   01e0   73                stxd
   01e1   25                dec R5
                            
   01e2   05                ldn R5
   01e3   73                stxd
   01e4   25                dec R5
                            
   01e5   05                ldn R5
   01e6   73                stxd            ;+11 divider, +11 shows the start of the data from the STACK pointer
                            
   01e7   f8 00             ldi 0           ;storing 0 for the subtractor
   01e9   73                stxd
   01ea   73                stxd
   01eb   73                stxd
   01ec   73                stxd            ;+7 subtractor
                            
   01ed   96                ghi R6          ;saving the quotient pointer
   01ee   73                stxd
   01ef   86                glo R6
   01f0   73                stxd            ;+5 quotient pointer
                        
   01f1   97                ghi R7          ;saving the remainder
   01f2   73                stxd
   01f3   87                glo R7
   01f4   73                stxd            ;+3 remainder pointer
                            
   01f5   94                ghi R4          ;saving the dividend pointer
   01f6   73                stxd
   01f7   84                glo R4
   01f8   73                stxd            ;+1 dividend pointer
                            
   01f9   e4                sex R4
                            
   01fa   72                ldxa            ;copy dividend to remainder
   01fb   57                str R7
   01fc   17                inc R7
                            
   01fd   72                ldxa
   01fe   57                str R7
   01ff   17                inc R7
                            
   0200   72                ldxa
   0201   57                str R7
   0202   17                inc R7
                            
   0203   f0                ldx
   0204   57                str R7
                            
   0205   f8 00             ldi 0
   0207   56                str R6
   0208   16                inc R6
   0209   56                str R6
   020a   16                inc R6
   020b   56                str R6
   020c   16                inc R6
   020d   56                str R6
                        
   020e   8f                glo STACK_REG   ;get the STACK_REG pointer to position it to the divider MSB
   020f   fc 0e             adi 14          ;add 14 to it
   0211   a5                plo R5          ;store the new pointer to R5
   0212   9f                ghi STACK_REG   ;get the STACK_REG high part to add the carry to it
   0213   7c 00             adci 0          ;adding the carry
   0215   b5                phi R5          ;store the new high part to R5
                            
   0216   e5                sex R5          ;set X data pointer to R5
   0217   f0                ldx             ;load data from RAM[R5]
   0218   25                dec R5          ;decrement R5 to set it back to the divider's LSB
   0219   25                dec R5
   021a   25                dec R5
   021b   fa 80             ani 080h        ;check if sign bit is set
                            
   021d   c2 02 34          lbz INTEGER_DIV_NEXT_CHECK
                            
   0220   f8 82             ldi 082h        ;load 0x82 to the D register
   0222   fe                shl             ;shit it left so it will set the carry flag and the D registre will be 4
   0223   a9                plo R9          ;store it to R9 low
                            
   0224                 INTEGER_DIV_INVERT_LOOP1
   0224   f0                ldx             ;load data from RAM[R5]
   0225   fb ff             xri 0FFh        ;xor D with 0xFF to invert it
   0227   7c 00             adci 0          ;add the carry for to the result (inver+1)
   0229   55                str R5          ;store the result to RAM[R5]
   022a   60                irx             ;increment R5
                        
   022b   29                dec R9          ;decrement R8
   022c   89                glo R9          ;get R8 low, and if it's not 0 then do the loop
   022d   ca 02 24          lbnz INTEGER_DIV_INVERT_LOOP1
                            
   0230   98                ghi R8          ;set the flag
   0231   f9 01             ori 1
   0233   b8                phi R8
                            
   0234                 INTEGER_DIV_NEXT_CHECK
   0234   8f                glo STACK_REG
   0235   fc 03             adi 3
   0237   a9                plo R9
   0238   9f                ghi STACK_REG
   0239   7c 00             adci 0
   023b   b9                phi R9
                            
   023c   09                ldn R9              ;restore and get remainder MSB
   023d   fc 03             adi 3
   023f   a4                plo R4
   0240   19                inc R9
   0241   09                ldn R9
   0242   7c 00             adci 0
   0244   b4                phi R4
                            
   0245   e4                sex R4
   0246   f0                ldx
   0247   24                dec R4
   0248   24                dec R4
   0249   24                dec R4
   024a   fa 80             ani 080h            ;check if sign bit is set
                            
   024c   c2 02 62          lbz INTEGER_SHIFT_DR
                            
   024f   f8 82             ldi 082h
   0251   fe                shl
   0252   a9                plo R9
                            
   0253                 INVERT_LOOP2
   0253   f0                ldx         ;invert byte 3
   0254   fb ff             xri 0FFh
   0256   7c 00             adci 0
   0258   54                str R4
   0259   60                irx
                        
   025a   29                dec R9
   025b   89                glo R9
   025c   3a 53             bnz INVERT_LOOP2
                            
   025e   98                ghi R8      ;set the flag
   025f   f9 02             ori 2
   0261   b8                phi R8
                            
   0262                 INTEGER_SHIFT_DR
   0262   8f                glo STACK_REG ;get divider MSB
   0263   fc 0b             adi 11
   0265   a5                plo R5
   0266   9f                ghi STACK_REG
   0267   7c 00             adci 0
   0269   b5                phi R5
                            
   026a   f8 00             ldi 0
   026c   e5                sex R5
   026d   f1                or
   026e   60                irx
   026f   f1                or
   0270   60                irx
   0271   f1                or
   0272   60                irx
   0273   f1                or
   0274   32 8d             bz DIVISION_LOOP
                            
   0276                 SHIFT_DR
   0276   8f                glo STACK_REG ;get divider MSB
   0277   fc 0e             adi 14
   0279   a5                plo R5
   027a   9f                ghi STACK_REG
   027b   7c 00             adci 0
   027d   b5                phi R5
                            
   027e   e5                sex R5
                            
   027f   f8 04             ldi 4
   0281   fe                shl
   0282   a9                plo R9
                            
   0283                 CARRY_SHIFTING
   0283   f0                ldx
   0284   76                shrc
   0285   73                stxd
                            
   0286   29                dec R9
   0287   89                glo R9
   0288   3a 83             bnz CARRY_SHIFTING
                            
   028a   18                inc R8
                            
   028b   30 62             br INTEGER_SHIFT_DR
                            
   028d                 DIVISION_LOOP
   028d   88                glo R8              ;get R8 low
   028e   fd 20             sdi 32              ;if larger than 32 then finish the loop
   0290   cb 03 1f          lbnf FINAL_CHECK
                        
   0293   8f                glo STACK_REG       ;restore quotient pointer to R6
   0294   fc 05             adi 5
   0296   a9                plo R9
   0297   9f                ghi STACK_REG
   0298   7c 00             adci 0
   029a   b9                phi R9
                            
   029b   09                ldn R9
   029c   a6                plo R6
   029d   19                inc R9
   029e   09                ldn R9
   029f   b6                phi R6
                            
   02a0   e6                sex R6
                            
   02a1   f8 02             ldi 2
   02a3   fe                shl
   02a4   a9                plo R9
                            
   02a5                 SHIFTING_Q
   02a5   f0                ldx                 ;shifting quotient to left
   02a6   7e                shlc
   02a7   56                str R6
   02a8   60                irx
                        
   02a9   29                dec R9
   02aa   89                glo R9
   02ab   3a a5             bnz SHIFTING_Q
                            
   02ad   8f                glo STACK_REG    ;restore remainder pointer to R4
   02ae   fc 03             adi 3
   02b0   a9                plo R9
   02b1   9f                ghi STACK_REG
   02b2   7c 00             adci 0
   02b4   b9                phi R9
                            
   02b5   09                ldn R9
   02b6   a4                plo R4
   02b7   19                inc R9
   02b8   09                ldn R9
   02b9   b4                phi R4
                            
   02ba   8f                glo STACK_REG    ;restore subtractor pointer to R5
   02bb   fc 07             adi 7
   02bd   a5                plo R5
   02be   9f                ghi STACK_REG
   02bf   7c 00             adci 0
   02c1   b5                phi R5
                            
   02c2   e4                sex R4
   02c3   f8 82             ldi 082h
   02c5   fe                shl
   02c6   a9                plo R9
                            
   02c7                 TRY_SUBTRACTING         ;try subtracting
   02c7   05                ldn R5
   02c8   75                sdb
   02c9   60                irx
   02ca   15                inc R5
                            
   02cb   29                dec R9
   02cc   89                glo R9
   02cd   3a c7             bnz TRY_SUBTRACTING
                            
   02cf   cb 03 07          lbnf NEXT_BIT        ;if subtracting unsuccesful, jump to NEXT_BIT
                            
   02d2   8f                glo STACK_REG
   02d3   fc 05             adi 5
   02d5   a9                plo R9
   02d6   9f                ghi STACK_REG
   02d7   7c 00             adci 0
   02d9   b9                phi R9
                            
   02da   09                ldn R9
   02db   a6                plo R6
   02dc   19                inc R9
   02dd   09                ldn R9
   02de   b6                phi R6
                            
   02df   06                ldn R6
   02e0   f9 01             ori 1
   02e2   56                str R6
                            
   02e3   8f                glo STACK_REG    ;restore remainder pointer
   02e4   fc 03             adi 3
   02e6   a9                plo R9
   02e7   9f                ghi STACK_REG
   02e8   7c 00             adci 0
   02ea   b9                phi R9
                            
   02eb   09                ldn R9
   02ec   a4                plo R4
   02ed   19                inc R9
   02ee   09                ldn R9
   02ef   b4                phi R4
                            
   02f0   8f                glo STACK_REG    ;restore subtractor's pointer to R5
   02f1   fc 07             adi 7
   02f3   a5                plo R5
   02f4   9f                ghi STACK_REG
   02f5   7c 00             adci 0
   02f7   b5                phi R5
                            
   02f8   e4                sex R4
                            
   02f9   f8 82             ldi 082h
   02fb   fe                shl
   02fc   a9                plo R9
                            
   02fd                 SUBTRACT_FOR_REAL
   02fd   05                ldn R5          ;subtract the subtractor from the remainder and store it
   02fe   75                sdb
   02ff   54                str R4
   0300   60                irx
   0301   15                inc R5
                            
   0302   29                dec R9
   0303   89                glo R9
   0304   ca 02 fd          lbnz SUBTRACT_FOR_REAL
                            
   0307                 NEXT_BIT
   0307   8f                glo STACK_REG    ;restore subtractor pointer to R5 and set it to MSB
   0308   fc 0a             adi 10
   030a   a5                plo R5
   030b   9f                ghi STACK_REG
   030c   7c 00             adci 0
   030e   b5                phi R5
                            
   030f   e5                sex R5
   0310   f8 02             ldi 2
   0312   fe                shl
   0313   a9                plo R9
                            
   0314                 SHIFT_SUBTRACTOR
   0314   f0                ldx
   0315   76                shrc
   0316   73                stxd
                            
   0317   29                dec R9
   0318   89                glo R9
   0319   3a 14             bnz SHIFT_SUBTRACTOR
                            
   031b   18                inc R8
   031c   c0 02 8d          lbr DIVISION_LOOP
                            
   031f                 FINAL_CHECK
   031f   98                ghi R8
   0320   fa 02             ani 2
   0322   c2 03 43          lbz FINAL_CHECK2
                            
   0325   8f                glo STACK_REG    ;restore remainder pointer to R4
   0326   fc 03             adi 3
   0328   a9                plo R9
   0329   9f                ghi STACK_REG
   032a   7c 00             adci 0
   032c   b9                phi R9
                            
   032d   09                ldn R9
   032e   a4                plo R4
   032f   19                inc R9
   0330   09                ldn R9
   0331   b4                phi R4
                            
   0332   e4                sex R4
                            
   0333   f8 82             ldi 082h
   0335   fe                shl
   0336   a9                plo R9
                            
   0337                 INVERT_LOOP3
   0337   f0                ldx
   0338   fb ff             xri 0FFh
   033a   7c 00             adci 0
   033c   54                str R4
   033d   60                irx
                            
   033e   29                dec R9
   033f   89                glo R9
   0340   ca 03 37          lbnz INVERT_LOOP3
                            
   0343                 FINAL_CHECK2
   0343   98                ghi R8
   0344   c2 03 69          lbz THE_END
   0347   fb 03             xri 3
   0349   c2 03 69          lbz THE_END
                            
   034c   8f                glo STACK_REG    ;restore quotient pointer to R6
   034d   fc 05             adi 5
   034f   a9                plo R9
   0350   9f                ghi STACK_REG
   0351   7c 00             adci 0
   0353   b9                phi R9
                            
   0354   09                ldn R9
   0355   a6                plo R6
   0356   19                inc R9
   0357   09                ldn R9
   0358   b6                phi R6
                            
   0359   e6                sex R6
                            
   035a   f8 82             ldi 082h
   035c   fe                shl
   035d   a9                plo R9
                            
   035e                 INVERT_LOOP4
   035e   f0                ldx
   035f   fb ff             xri 0FFh
   0361   7c 00             adci 0
   0363   56                str R6
   0364   60                irx
                            
   0365   29                dec R9
   0366   89                glo R9
   0367   3a 5e             bnz INVERT_LOOP4
                        
   0369                 THE_END
   0369   8f                glo STACK_REG       ;setting back the STACK_REG for return
   036a   fc 0e             adi 14
   036c   af                plo STACK_REG
   036d   9f                ghi STACK_REG
   036e   7c 00             adci 0
   0370   bf                phi STACK_REG
                            
   0371   de                sep RETURN          ;RETURN
                        ;----------------------------------------------
                        
                        ;-INTEGER MUL----------------------------------
                        ;-R4-multiplicand pointer----------------------
                        ;-R5-multiplier pointer------------------------
                        ;-R6-result pointer----------------------------
                        ;-R7-general register--------------------------
   0372                 INTEGER_MUL
   0372   ef                sex STACK_REG
                            
   0373   14                inc R4      ;increment R4 and R5 pointer to MSB
   0374   14                inc R4      ;to copy the values to the local variables
   0375   14                inc R4
                            
   0376   15                inc R5
   0377   15                inc R5
   0378   15                inc R5
                            
   0379   04                ldn R4      ;copying starts here
   037a   73                stxd
   037b   24                dec R4
                            
   037c   04                ldn R4
   037d   73                stxd
   037e   24                dec R4
                            
   037f   04                ldn R4
   0380   73                stxd
   0381   24                dec R4
                            
   0382   04                ldn R4
   0383   73                stxd        ;+7 multiplicand
                            
   0384   05                ldn R5
   0385   73                stxd
   0386   25                dec R5
                            
   0387   05                ldn R5
   0388   73                stxd
   0389   25                dec R5
                            
   038a   05                ldn R5
   038b   73                stxd
   038c   25                dec R5
                            
   038d   05                ldn R5
   038e   73                stxd        ;+3 multiplier
                            
   038f   96                ghi R6
   0390   73                stxd
   0391   86                glo R6
   0392   73                stxd        ;+1 result pointer
                        
   0393   f8 00             ldi 0       ;zeroing the result
                            
   0395   56                str R6
   0396   16                inc R6
                            
   0397   56                str R6
   0398   16                inc R6
                            
   0399   56                str R6
   039a   16                inc R6
                            
   039b   56                str R6
                            
   039c   26                dec R6
   039d   26                dec R6
   039e   26                dec R6
                        
   039f                 INTEGER_MUL_LOOP
   039f   8f                glo STACK_REG   ;restore multiplier pointer
   03a0   fc 03             adi 3
   03a2   a5                plo R5
   03a3   9f                ghi STACK_REG
   03a4   7c 00             adci 0
   03a6   b5                phi R5
                            
   03a7   e5                sex R5          ;check if multiplier is 0
   03a8   f8 00             ldi 0
   03aa   f1                or
   03ab   60                irx
   03ac   f1                or
   03ad   60                irx
   03ae   f1                or
   03af   60                irx
   03b0   f1                or
                            
   03b1   25                dec R5
   03b2   25                dec R5
   03b3   25                dec R5
                            
   03b4   c2 04 09          lbz INTEGER_MUL_END      ;if 0 then jump to the end
                            
   03b7   05                ldn R5                  ;load the multiplier's LSB
   03b8   fa 01             ani 1                   ;filter for the LSb
   03ba   32 dc             bz INTEGER_MUL_SHIFT    ;if zero, skip the addition
                            
   03bc   8f                glo STACK_REG           ;restore multiplicand pointer
   03bd   fc 07             adi 7
   03bf   a4                plo R4
   03c0   9f                ghi STACK_REG
   03c1   7c 00             adci 0
   03c3   b4                phi R4
                            
   03c4   8f                glo STACK_REG           ;restore result pointer
   03c5   a7                plo R7
   03c6   9f                ghi STACK_REG
   03c7   b7                phi R7
   03c8   17                inc R7
                            
   03c9   07                ldn R7
   03ca   a5                plo R5
   03cb   17                inc R7
   03cc   07                ldn R7
   03cd   b5                phi R5
                            
   03ce   e5                sex R5
                            
   03cf   f8 02             ldi 2                   ;prepare addition
   03d1   fe                shl
   03d2   a7                plo R7
                            
   03d3                 INTEGER_MUL_ADD
   03d3   04                ldn R4
   03d4   74                adc
   03d5   55                str R5
   03d6   60                irx
   03d7   14                inc R4
                            
   03d8   27                dec R7
   03d9   87                glo R7
   03da   3a d3             bnz INTEGER_MUL_ADD
                        
   03dc                 INTEGER_MUL_SHIFT
                        
   03dc   8f                glo STACK_REG           ;set multiplier's pointer to MSB
   03dd   fc 06             adi 6                   ;to shift it right
   03df   a5                plo R5
   03e0   9f                ghi STACK_REG
   03e1   7c 00             adci 0
   03e3   b5                phi R5
                            
   03e4   e5                sex R5
                            
   03e5   f8 02             ldi 2
   03e7   fe                shl
   03e8   a7                plo R7
                            
   03e9                 INTEGER_MUL_SHMULTIPLIER
   03e9   f0                ldx                     ;shifting right the multiplier
   03ea   76                shrc
   03eb   73                stxd
                            
   03ec   27                dec R7
   03ed   87                glo R7
   03ee   3a e9             bnz INTEGER_MUL_SHMULTIPLIER
                            
   03f0   8f                glo STACK_REG           ;restore multiplicand pointer
   03f1   fc 07             adi 7                   ;to shift it left
   03f3   a4                plo R4
   03f4   9f                ghi STACK_REG
   03f5   7c 00             adci 0
   03f7   b4                phi R4
                            
   03f8   e4                sex R4
                            
   03f9   f8 02             ldi 2
   03fb   fe                shl
   03fc   a7                plo R7
                            
   03fd                 INTEGER_MUL_SHMULTIPLICAND
   03fd   f0                ldx                     ;shifting the multiplicand left
   03fe   7e                shlc
   03ff   54                str R4
   0400   60                irx
                        
   0401   27                dec R7
   0402   87                glo R7
   0403   ca 03 fd          lbnz INTEGER_MUL_SHMULTIPLICAND
                            
   0406   c0 03 9f          lbr INTEGER_MUL_LOOP
                            
   0409                 INTEGER_MUL_END
   0409   8f                glo STACK_REG
   040a   fc 0a             adi 10
   040c   af                plo STACK_REG
   040d   9f                ghi STACK_REG
   040e   7c 00             adci 0
   0410   bf                phi STACK_REG
                            
   0411   de                sep RETURN          ;RETURN    
                        ;----------------------------------------------
                        
                        ;-PRINT HEX------------------------------------
                        ;-R4-int pointer-------------------------------
                        ;-R5.0-number of digits------------------------
                        ;-Local registers------------------------------
                        ;-R5.1-flag, R6--------------------------------
   0412                 HEX_CHARS
   0412   30 31 32 33       db "0123456789ABCDEF"
   0416   34 35 36 37   
   041a   38 39 41 42   
   041e   43 44 45 46   
                        ;----------------------------------------------
   0422                 PRINT_HEX
   0422   ef                sex STACK_REG
                            
   0423   95                ghi R5  ;saving the state of the local registers
   0424   73                stxd
                            
   0425   96                ghi R6
   0426   73                stxd
   0427   86                glo R6
   0428   73                stxd
                            
   0429   14                inc R4  ;making a copy of the Integer
   042a   14                inc R4
   042b   14                inc R4
                            
   042c   04                ldn R4
   042d   73                stxd
   042e   24                dec R4
   042f   04                ldn R4
   0430   73                stxd
   0431   24                dec R4
   0432   04                ldn R4
   0433   73                stxd
   0434   24                dec R4
   0435   04                ldn R4
   0436   73                stxd    ;+2 the integer
                            
   0437   f8 00             ldi 0   ;+1 
   0439   73                stxd
                            
   043a   8f                glo STACK_REG   ;set R4 to point to the Integer
   043b   a4                plo R4
   043c   9f                ghi STACK_REG
   043d   b4                phi R4
   043e   14                inc R4
   043f   14                inc R4
                            
   0440   f8 00             ldi 0           ;set R5 flags to 0
   0442   b5                phi R5
   0443   85                glo R5              
   0444   3a 49             bnz PRINT_UNTIL_R
   0446   f8 01             ldi 1           ;if R5 low, the number of digits, is zero, then set R5 flag
   0448   b5                phi R5
                        
   0449                 PRINT_UNTIL_R
   0449   95                ghi R5                  ;check the flag if set or not
   044a   32 5e             bz PRINT_CHECK_DIGIT    
   044c   e4                sex R4              ;checking the integer if it's zero
   044d   f8 00             ldi 0
   044f   f1                or
   0450   60                irx
   0451   f1                or
   0452   60                irx
   0453   f1                or
   0454   60                irx
   0455   f1                or
                            
   0456   24                dec R4
   0457   24                dec R4
   0458   24                dec R4
                            
   0459   ef                sex STACK_REG    
   045a   3a 61             bnz PRINT_DIGIT_LOOP
   045c   30 8f             br PRINT_HEX_END
                            
   045e                 PRINT_CHECK_DIGIT
   045e   85                glo R5
   045f   32 8f             bz PRINT_HEX_END
                        
   0461                 PRINT_DIGIT_LOOP
   0461   04                ldn R4
   0462   fa 0f             ani 0Fh
   0464   5f                str STACK_REG
   0465   f8 12             ldi HEX_CHARS.0
   0467   f4                add
   0468   a6                plo R6
   0469   f8 04             ldi HEX_CHARS.1
   046b   7c 00             adci 0
   046d   b6                phi R6
                            
   046e   06                ldn R6
   046f   73                stxd
                            
   0470   f8 04             ldi 4
   0472   a6                plo R6
                            
   0473                 PRINT_HEX_SHIFT_LOOP1
   0473   14                inc R4
   0474   14                inc R4
   0475   14                inc R4
                            
   0476   04                ldn R4
   0477   f6                shr
   0478   54                str R4
   0479   24                dec R4
                            
   047a   04                ldn R4
   047b   76                shrc
   047c   54                str R4
   047d   24                dec R4
                            
   047e   04                ldn R4
   047f   76                shrc
   0480   54                str R4
   0481   24                dec R4
                            
   0482   04                ldn R4
   0483   76                shrc
   0484   54                str R4
                            
   0485   26                dec R6
   0486   86                glo R6
   0487   3a 73             bnz PRINT_HEX_SHIFT_LOOP1
                            
   0489   95                ghi R5      ;check if R5 flag is set, if set then skip decrementing.
   048a   c6                lsnz
   048b   25                dec R5
   048c   c4                nop
   048d   30 49             br PRINT_UNTIL_R
                        
   048f                 PRINT_HEX_END
   048f   8f                glo STACK_REG
   0490   a6                plo R6
   0491   9f                ghi STACK_REG
   0492   b6                phi R6
   0493   16                inc R6
                            
   0494   f8 52             ldi PRINT.0     ;prepare to call PRINT
   0496   ad                plo CALL_REG
   0497   f8 01             ldi PRINT.1
   0499   bd                phi CALL_REG
                            
   049a   f8 00             ldi FCALL.0
   049c   ae                plo FCALL_REG
   049d   de                sep FCALL_REG
                            
   049e   86                glo R6
   049f   fc 04             adi 4
   04a1   af                plo STACK_REG
   04a2   96                ghi R6
   04a3   7c 00             adci 0
   04a5   bf                phi STACK_REG
                            
   04a6   ef                sex STACK_REG   ;restore local registers
   04a7   72                ldxa
   04a8   a6                plo R6
   04a9   72                ldxa
   04aa   b6                phi R6
   04ab   f0                ldx
   04ac   b5                phi R5
                            
   04ad   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-PRINT DEC------------------------------------
                        ;-R4-int pointer-------------------------------
                        ;-Local registers------------------------------
                        ;-R5-R6-R7-R10-R12-----------------------------
                        ;-R10-flags------------------------------------
   04ae                 PRINT_DEC
   04ae   ef                sex STACK_REG
                            
   04af   95                ghi R5          ;saving local registers
   04b0   73                stxd
   04b1   85                glo R5
   04b2   73                stxd
                            
   04b3   96                ghi R6
   04b4   73                stxd
   04b5   86                glo R6
   04b6   73                stxd
                            
   04b7   97                ghi R7
   04b8   73                stxd
   04b9   87                glo R7
   04ba   73                stxd
                        
   04bb   9a                ghi R10
   04bc   73                stxd
   04bd   8a                glo R10
   04be   73                stxd
                            
   04bf   9c                ghi R12
   04c0   73                stxd
   04c1   8c                glo R12
   04c2   73                stxd
                            
   04c3   f8 00             ldi 0
   04c5   aa                plo R10
   04c6   ba                phi R10
                            
   04c7   14                inc R4
   04c8   14                inc R4
   04c9   14                inc R4
                            
   04ca   04                ldn R4
   04cb   73                stxd
   04cc   24                dec R4
   04cd   04                ldn R4
   04ce   73                stxd
   04cf   24                dec R4
   04d0   04                ldn R4
   04d1   73                stxd
   04d2   24                dec R4
   04d3   04                ldn R4
   04d4   73                stxd        ;+10 the integer
                            
   04d5   f8 00             ldi 0
   04d7   73                stxd
   04d8   73                stxd
   04d9   73                stxd
   04da   f8 0a             ldi 0Ah
   04dc   73                stxd        ;+6 divider
                            
   04dd   f8 00             ldi 0
   04df   73                stxd
   04e0   73                stxd
   04e1   73                stxd
   04e2   73                stxd        ;+2 remainder
                            
   04e3   73                stxd        ;+1 output string buffer end
                            
   04e4   8f                glo STACK_REG
   04e5   ac                plo R12
   04e6   9f                ghi STACK_REG
   04e7   bc                phi R12
                            
   04e8   8c                glo R12
   04e9   fc 0d             adi 13
   04eb   a4                plo R4
   04ec   9c                ghi R12
   04ed   7c 00             adci 0
   04ef   b4                phi R4
                            
   04f0   e4                sex R4
   04f1   f0                ldx
   04f2   fa 80             ani 080h
   04f4   c2 05 0d          lbz PRINT_DEC_MAIN_LOOP
                            
   04f7   8a                glo R10
   04f8   f9 01             ori 1
   04fa   aa                plo R10
                            
   04fb   24                dec R4
   04fc   24                dec R4
   04fd   24                dec R4
                            
   04fe   f8 82             ldi 082h
   0500   fe                shl
   0501   a6                plo R6
                            
   0502                 PRINT_DEC_INVER_LOOP
   0502   f0                ldx
   0503   fb ff             xri 0FFh
   0505   7c 00             adci 0
   0507   54                str R4
   0508   14                inc R4
                            
   0509   26                dec R6
   050a   86                glo R6
   050b   3a 02             bnz PRINT_DEC_INVER_LOOP
                            
   050d                 PRINT_DEC_MAIN_LOOP    
   050d   8c                glo R12
   050e   fc 0a             adi 10
   0510   a4                plo R4
   0511   a6                plo R6
   0512   9c                ghi R12
   0513   7c 00             adci 0
   0515   b4                phi R4
   0516   b6                phi R6
                            
   0517   8c                glo R12
   0518   fc 06             adi 6
   051a   a5                plo R5
   051b   9c                ghi R12
   051c   7c 00             adci 0
   051e   b5                phi R5
                            
   051f   8c                glo R12
   0520   fc 02             adi 2
   0522   a7                plo R7
   0523   9c                ghi R12
   0524   7c 00             adci 0
   0526   b7                phi R7
                            
   0527   f8 d4             ldi INTEGER_DIV.0
   0529   ad                plo CALL_REG
   052a   f8 01             ldi INTEGER_DIV.1
   052c   bd                phi CALL_REG
                            
   052d   f8 00             ldi FCALL.0
   052f   ae                plo FCALL_REG
   0530   de                sep FCALL_REG
                            
   0531   ef                sex STACK_REG
                            
   0532   8c                glo R12
   0533   fc 02             adi 2
   0535   a7                plo R7
   0536   9c                ghi R12
   0537   7c 00             adci 0
   0539   b7                phi R7
                            
   053a   07                ldn R7
   053b   fc 30             adi 48
   053d   73                stxd
                            
   053e   8c                glo R12
   053f   fc 0a             adi 10
   0541   a4                plo R4
   0542   9c                ghi R12
   0543   7c 00             adci 0
   0545   b4                phi R4
                            
   0546   e4                sex R4
                            
   0547   f8 00             ldi 0
   0549   f1                or
   054a   60                irx
   054b   f1                or
   054c   60                irx
   054d   f1                or
   054e   60                irx
   054f   f1                or
                            
   0550   32 55             bz PRINT_DEC_END
   0552   c0 05 0d          lbr PRINT_DEC_MAIN_LOOP
                        
   0555                 PRINT_DEC_END
   0555   8a                glo R10
   0556   fa 01             ani 1
   0558   32 5e             bz PRINT_DEC_FINAL
                            
   055a   ef                sex STACK_REG
   055b   f8 2d             ldi 45
   055d   73                stxd
                        
   055e                 PRINT_DEC_FINAL
   055e   8f                glo STACK_REG
   055f   a6                plo R6
   0560   9f                ghi STACK_REG
   0561   b6                phi R6
   0562   16                inc R6
                            
   0563   f8 52             ldi PRINT.0
   0565   ad                plo CALL_REG
   0566   f8 01             ldi PRINT.1
   0568   bd                phi CALL_REG
                            
   0569   f8 00             ldi FCALL.0
   056b   ae                plo FCALL_REG
   056c   de                sep FCALL_REG
                            
   056d   8c                glo R12
   056e   fc 0e             adi 14
   0570   af                plo STACK_REG
   0571   9c                ghi R12
   0572   7c 00             adci 0
   0574   bf                phi STACK_REG
                            
   0575   ef                sex STACK_REG
                            
   0576   72                ldxa
   0577   ac                plo R12
   0578   72                ldxa
   0579   bc                phi R12
                            
   057a   72                ldxa
   057b   aa                plo R10
   057c   72                ldxa
   057d   ba                phi R10
                            
   057e   72                ldxa
   057f   a7                plo R7
   0580   72                ldxa
   0581   b7                phi R7
                            
   0582   72                ldxa
   0583   a6                plo R6
   0584   72                ldxa
   0585   b6                phi R6
                            
   0586   72                ldxa
   0587   a5                plo R5
   0588   f0                ldx
   0589   b5                phi R5
                            
   058a   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-READ DEC-------------------------------------
                        ;-R4-string pointer----------------------------
                        ;-R5-result pointer----------------------------
   058b                 READ_DEC
   058b   ef                sex STACK_REG
                            
   058c   94                ghi R4
   058d   73                stxd
   058e   84                glo R4
   058f   73                stxd        ;+7 string pointer
                            
   0590   95                ghi R5
   0591   73                stxd
   0592   85                glo R5
   0593   73                stxd        ;+5 result pointer
                            
   0594   f8 00             ldi 0
   0596   73                stxd
   0597   73                stxd
   0598   73                stxd
   0599   f8 0a             ldi 0Ah
   059b   73                stxd        ;+1 multiplier
                            
   059c   f8 00             ldi 0       ;set result to 0
   059e   55                str R5
   059f   15                inc R5
   05a0   55                str R5
   05a1   15                inc R5
   05a2   55                str R5
   05a3   15                inc R5
   05a4   55                str R5
                            
   05a5                 READ_DEC_MAIN_LOOP
   05a5   8f                glo STACK_REG
   05a6   fc 07             adi 7
   05a8   a6                plo R6
   05a9   9f                ghi STACK_REG
   05aa   7c 00             adci 0
   05ac   b6                phi R6
                            
   05ad   06                ldn R6
   05ae   a4                plo R4
   05af   16                inc R6
   05b0   06                ldn R6
   05b1   b4                phi R4
                            
   05b2   04                ldn R4
   05b3   ff 30             smi 48
   05b5   cb 06 1c          lbnf READ_DEC_END
   05b8   ff 0a             smi 10
   05ba   c3 06 1c          lbdf READ_DEC_END
                            
   05bd   8f                glo STACK_REG
   05be   fc 05             adi 5
   05c0   a6                plo R6
   05c1   9f                ghi STACK_REG
   05c2   7c 00             adci 0
   05c4   b6                phi R6
                            
   05c5   06                ldn R6
   05c6   a4                plo R4
   05c7   16                inc R6
   05c8   06                ldn R6
   05c9   b4                phi R4
                            
   05ca   b6                phi R6
   05cb   84                glo R4
   05cc   a6                plo R6
                            
   05cd   8f                glo STACK_REG
   05ce   a5                plo R5
   05cf   9f                ghi STACK_REG
   05d0   b5                phi R5
   05d1   15                inc R5
                            
   05d2   f8 72             ldi INTEGER_MUL.0     ;prepare to call INTEGER_MUL
   05d4   ad                plo CALL_REG
   05d5   f8 03             ldi INTEGER_MUL.1       
   05d7   bd                phi CALL_REG
                            
   05d8   f8 00             ldi FCALL.0
   05da   ae                plo FCALL_REG
   05db   de                sep FCALL_REG
                            
   05dc   8f                glo STACK_REG
   05dd   fc 07             adi 7
   05df   a6                plo R6
   05e0   9f                ghi STACK_REG
   05e1   7c 00             adci 0
   05e3   b6                phi R6
                            
   05e4   06                ldn R6
   05e5   a4                plo R4
   05e6   16                inc R6
   05e7   06                ldn R6
   05e8   b4                phi R4
                            
   05e9   8f                glo STACK_REG
   05ea   fc 05             adi 5
   05ec   a6                plo R6
   05ed   9f                ghi STACK_REG
   05ee   7c 00             adci 0
   05f0   b6                phi R6
                            
   05f1   06                ldn R6
   05f2   a5                plo R5
   05f3   16                inc R6
   05f4   06                ldn R6
   05f5   b5                phi R5
                            
   05f6   e5                sex R5
                            
   05f7   04                ldn R4
   05f8   ff 30             smi 48
                            
   05fa   f4                add
   05fb   55                str R5
   05fc   15                inc R5
                            
   05fd   f8 00             ldi 0
   05ff   74                adc
   0600   55                str R5
   0601   15                inc R5
                            
   0602   f8 00             ldi 0
   0604   74                adc
   0605   55                str R5
   0606   15                inc R5
                            
   0607   f8 00             ldi 0
   0609   74                adc
   060a   55                str R5
                        
   060b   14                inc R4
                            
   060c   8f                glo STACK_REG
   060d   fc 07             adi 7
   060f   a6                plo R6
   0610   9f                ghi STACK_REG
   0611   7c 00             adci 0
   0613   b6                phi R6
                            
   0614   84                glo R4
   0615   56                str R6
   0616   16                inc R6
   0617   94                ghi R4
   0618   56                str R6
                            
   0619   c0 05 a5          lbr READ_DEC_MAIN_LOOP
                           
   061c                 READ_DEC_END
   061c   8f                glo STACK_REG
   061d   fc 05             adi 5
   061f   af                plo STACK_REG
   0620   9f                ghi STACK_REG
   0621   7c 00             adci 0
   0623   bf                phi STACK_REG
                            
   0624   ef                sex STACK_REG
                            
   0625   72                ldxa            ;restore R4 and R5
   0626   a5                plo R5
   0627   72                ldxa
   0628   b5                phi R5
   0629   72                ldxa
   062a   a4                plo R4
   062b   f0                ldx
   062c   b4                phi R4
                            
   062d   de                sep RETURN      ;RETURN    
                        ;----------------------------------------------
                        
                        ;-READ HEX-------------------------------------
                        ;-R4-string pointer----------------------------
                        ;-R5-result pointer----------------------------
   062e                 READ_HEX
   062e   ef                sex STACK_REG
                            
   062f   96                ghi R6
   0630   73                stxd
   0631   86                glo R6
   0632   73                stxd
                            
   0633   97                ghi R7
   0634   73                stxd
   0635   87                glo R7
   0636   73                stxd
                            
   0637   94                ghi R4
   0638   73                stxd
   0639   84                glo R4
   063a   73                stxd        ;+3 string pointer
                            
   063b   95                ghi R5
   063c   73                stxd
   063d   85                glo R5
   063e   73                stxd        ;+1 result pointer
                            
   063f   f8 00             ldi 0       ;set result to 0
   0641   55                str R5
   0642   15                inc R5
   0643   55                str R5
   0644   15                inc R5
   0645   55                str R5
   0646   15                inc R5
   0647   55                str R5
                            
   0648   25                dec R5
   0649   25                dec R5
   064a   25                dec R5
                            
   064b                 READ_HEX_MAINLOOP
   064b   f8 00             ldi 0
   064d   a7                plo R7
                            
   064e   04                ldn R4
   064f   ff 30             smi 48
   0651   3b 9e             bm READ_HEX_END
   0653   17                inc R7
   0654   ff 0a             smi 10
   0656   3b 6a             bm READ_HEX_CONTINUE
   0658   ff 07             smi 7
   065a   3b 9e             bm READ_HEX_END
   065c   17                inc R7
   065d   ff 06             smi 6
   065f   3b 6a             bm READ_HEX_CONTINUE
   0661   ff 1a             smi 26
   0663   3b 9e             bm READ_HEX_END
   0665   17                inc R7
   0666   ff 06             smi 6
   0668   33 9e             bpz READ_HEX_END
                            
   066a                 READ_HEX_CONTINUE
   066a   f8 04             ldi 4
   066c   a6                plo R6
                        
   066d                 READ_HEX_SHIFTLOOP      ;result = result << 4
   066d   05                ldn R5
   066e   fe                shl
   066f   55                str R5
   0670   15                inc R5
                            
   0671   05                ldn R5
   0672   7e                shlc
   0673   55                str R5
   0674   15                inc R5
                            
   0675   05                ldn R5
   0676   7e                shlc
   0677   55                str R5
   0678   15                inc R5
                            
   0679   05                ldn R5
   067a   7e                shlc
   067b   55                str R5
                            
   067c   25                dec R5
   067d   25                dec R5
   067e   25                dec R5
                            
   067f   26                dec R6
   0680   86                glo R6
   0681   3a 6d             bnz READ_HEX_SHIFTLOOP
                            
   0683   e5                sex R5
                            
   0684   27                dec R7
   0685   87                glo R7
   0686   3a 8d             bnz READ_HEX_HEXDIGIT
   0688   04                ldn R4
   0689   ff 30             smi 48
   068b   30 99             br READ_HEX_NEXTCHAR
                        
   068d                 READ_HEX_HEXDIGIT   
   068d   27                dec R7
   068e   87                glo R7
   068f   3a 96             bnz READ_HEX_HEXDIGITLOWER
   0691   04                ldn R4
   0692   ff 37             smi 55
   0694   30 99             br READ_HEX_NEXTCHAR
                            
   0696                 READ_HEX_HEXDIGITLOWER
   0696   04                ldn R4
   0697   ff 57             smi 87
                            
   0699                 READ_HEX_NEXTCHAR
   0699   f4                add
   069a   55                str R5
   069b   14                inc R4
   069c   30 4b             br READ_HEX_MAINLOOP
                        
   069e                 READ_HEX_END
   069e   8f                glo STACK_REG
   069f   fc 05             adi 5
   06a1   af                plo STACK_REG
   06a2   9f                ghi STACK_REG
   06a3   7c 00             adci 0
   06a5   bf                phi STACK_REG
                            
   06a6   ef                sex STACK_REG
                            
   06a7   72                ldxa
   06a8   a7                plo R7
   06a9   72                ldxa
   06aa   b7                phi R7
                            
   06ab   72                ldxa
   06ac   a6                plo R6
   06ad   f0                ldx
   06ae   b6                phi R6
                            
   06af   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-FACTOR---------------------------------------
                        ;-R4-string pointer----------------------------
                        ;-R5-result pointer----------------------------
                        ;-R10-result code------------------------------
   06b0                 FACTOR
   06b0   ef                sex STACK_REG
                            
   06b1   94                ghi R4
   06b2   73                stxd
   06b3   84                glo R4
   06b4   73                stxd    ;+4 string pt
                            
   06b5   95                ghi R5
   06b6   73                stxd
   06b7   85                glo R5
   06b8   73                stxd    ;+2 result pt
                            
   06b9   f8 00             ldi 0
   06bb   73                stxd    ;+1 flag, indicates if the factor needs to be negated
                            
                            
   06bc                 FACTOR_MAIN
   06bc   04                ldn R4
   06bd   fb 20             xri 32
   06bf   c2 07 2b          lbz FACTOR_NEXT_CYCLE       ;if ' '
   06c2   04                ldn R4
   06c3   fb 2b             xri 43
   06c5   c2 07 2b          lbz FACTOR_NEXT_CYCLE       ;if '+'
   06c8   04                ldn R4
   06c9   fb 2d             xri 45
   06cb   c2 07 20          lbz FACTOR_NEGATE           ;if '-'
   06ce   04                ldn R4
   06cf   fb 28             xri 40
   06d1   c2 07 06          lbz FACTOR_PARENTHESIS      ;if '('
   06d4   04                ldn R4
   06d5   ff 30             smi 48
   06d7   cb 07 2f          lbnf FACTOR_END             ;if *R4 < '0'
   06da   ff 0a             smi 10
   06dc   c3 07 2f          lbdf FACTOR_END             ;if *R4 > '9'
                        
   06df   04                ldn R4
   06e0   fb 30             xri 48
   06e2   3a eb             bnz FACTOR_READ_DEC         ;if *R4 != '0'
                            
   06e4   14                inc R4                      ;increment R4 to get the next char
   06e5   04                ldn R4
   06e6   fb 78             xri 120
   06e8   32 f8             bz FACTOR_READ_HEX          ;if *R4 == 'x'
                            
   06ea   24                dec R4                      ;decrement R4 to step back
                        
   06eb                 FACTOR_READ_DEC    
   06eb   f8 8b             ldi READ_DEC.0
   06ed   ad                plo CALL_REG
   06ee   f8 05             ldi READ_DEC.1
   06f0   bd                phi CALL_REG
                            
   06f1   f8 00             ldi FCALL.0
   06f3   ae                plo FCALL_REG
   06f4   de                sep FCALL_REG
                            
   06f5   c0 07 2f          lbr FACTOR_END
                            
   06f8                 FACTOR_READ_HEX
   06f8   14                inc R4
                            
   06f9   f8 2e             ldi READ_HEX.0
   06fb   ad                plo CALL_REG
   06fc   f8 06             ldi READ_HEX.1
   06fe   bd                phi CALL_REG
                            
   06ff   f8 00             ldi FCALL.0
   0701   ae                plo FCALL_REG
   0702   de                sep FCALL_REG
                            
   0703   c0 07 2f          lbr FACTOR_END
                            
   0706                 FACTOR_PARENTHESIS
   0706   14                inc R4
                            
   0707   f8 55             ldi EXPRESSION.0
   0709   ad                plo CALL_REG
   070a   f8 08             ldi EXPRESSION.1
   070c   bd                phi CALL_REG
                            
   070d   f8 00             ldi FCALL.0
   070f   ae                plo FCALL_REG
   0710   de                sep FCALL_REG
                        
   0711                 FACTOR_PARENTHESIS_SKIPSPACES
   0711   44                lda R4
   0712   fb 20             xri 32
   0714   32 11             bz FACTOR_PARENTHESIS_SKIPSPACES
   0716   24                dec R4
                            
   0717   44                lda R4
   0718   fb 29             xri 41
   071a   c2 07 2f          lbz FACTOR_END
                            
   071d   c0 06 bc          lbr FACTOR_MAIN
                            
   0720                 FACTOR_NEGATE
   0720   8f                glo STACK_REG
   0721   a6                plo R6
   0722   9f                ghi STACK_REG
   0723   b6                phi R6
   0724   16                inc R6
                            
   0725   06                ldn R6
   0726   fb ff             xri 0FFh
   0728   fa 01             ani 1
   072a   56                str R6
                            
   072b                 FACTOR_NEXT_CYCLE
   072b   14                inc R4
   072c   c0 06 bc          lbr FACTOR_MAIN
                            
   072f                 FACTOR_END
   072f   8f                glo STACK_REG
   0730   a6                plo R6
   0731   9f                ghi STACK_REG
   0732   b6                phi R6
   0733   16                inc R6
                            
   0734   06                ldn R6
   0735   c2 07 55          lbz FACTOR_FINAL
                            
   0738   8f                glo STACK_REG
   0739   fc 02             adi 2
   073b   a6                plo R6
   073c   9f                ghi STACK_REG
   073d   7c 00             adci 0
   073f   b6                phi R6
                            
   0740   06                ldn R6
   0741   a5                plo R5
   0742   16                inc R6
   0743   06                ldn R6
   0744   b5                phi R5
                            
   0745   e5                sex R5
                            
   0746   f8 82             ldi 082h
   0748   fe                shl
   0749   a6                plo R6
                            
   074a                 FACTOR_INVERTING
   074a   f0                ldx
   074b   fb ff             xri 0FFh
   074d   7c 00             adci 0
   074f   55                str R5
   0750   60                irx
                            
   0751   26                dec R6
   0752   86                glo R6
   0753   3a 4a             bnz FACTOR_INVERTING
                            
   0755                 FACTOR_FINAL
   0755   8f                glo STACK_REG
   0756   fc 05             adi 5
   0758   af                plo STACK_REG
   0759   9f                ghi STACK_REG
   075a   7c 00             adci 0
   075c   bf                phi STACK_REG
                            
   075d   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-TERM-----------------------------------------
                        ;-R4-string pointer----------------------------
                        ;-R5-result------------------------------------
   075e                 TERM
   075e   ef                sex STACK_REG
                            
   075f   94                ghi R4
   0760   73                stxd
   0761   84                glo R4
   0762   73                stxd
                            
   0763   95                ghi R5
   0764   73                stxd
   0765   85                glo R5
   0766   73                stxd
                            
   0767   f8 b0             ldi FACTOR.0
   0769   ad                plo CALL_REG
   076a   f8 06             ldi FACTOR.1
   076c   bd                phi CALL_REG
                            
   076d   f8 00             ldi FCALL.0
   076f   ae                plo FCALL_REG
   0770   de                sep FCALL_REG
                            
   0771                 TERM_MAIN
   0771   04                ldn R4
   0772   fb 20             xri 32
   0774   c2 08 3f          lbz TERM_NEXT_CYCLE
   0777   04                ldn R4
   0778   fb 2a             xri 42
   077a   c2 07 ea          lbz TERM_MULTIPLY       ;if '*'
   077d   04                ldn R4
   077e   fb 2f             xri 47
   0780   32 85             bz TERM_DIVIDE          ;if '/'
                            
   0782   c0 08 43          lbr TERM_END
                            
   0785                 TERM_DIVIDE
   0785   14                inc R4
                            
   0786   f8 00             ldi 0
   0788   73                stxd
   0789   73                stxd
   078a   73                stxd
   078b   73                stxd    ;+5 remainder
                            
   078c   73                stxd
   078d   73                stxd
   078e   73                stxd
   078f   73                stxd    ;+1 divider
                            
   0790   8f                glo STACK_REG
   0791   a5                plo R5
   0792   9f                ghi STACK_REG
   0793   b5                phi R5
   0794   15                inc R5
                            
   0795   f8 b0             ldi FACTOR.0
   0797   ad                plo CALL_REG
   0798   f8 06             ldi FACTOR.1
   079a   bd                phi CALL_REG
                            
   079b   f8 00             ldi FCALL.0
   079d   ae                plo FCALL_REG
   079e   de                sep FCALL_REG
                            
   079f   8f                glo STACK_REG ;save R4 pointer
   07a0   fc 0b             adi 11
   07a2   a6                plo R6
   07a3   9f                ghi STACK_REG
   07a4   7c 00             adci 0
   07a6   b6                phi R6
                            
   07a7   84                glo R4
   07a8   56                str R6
   07a9   16                inc R6
   07aa   94                ghi R4
   07ab   56                str R6
                            
   07ac   8f                glo STACK_REG
   07ad   fc 09             adi 9
   07af   a8                plo R8
   07b0   9f                ghi STACK_REG
   07b1   7c 00             adci 0
   07b3   b8                phi R8
                            
   07b4   08                ldn R8
   07b5   a4                plo R4
   07b6   a6                plo R6
   07b7   18                inc R8
   07b8   08                ldn R8
   07b9   b4                phi R4
   07ba   b6                phi R6
                            
   07bb   8f                glo STACK_REG
   07bc   a5                plo R5
   07bd   9f                ghi STACK_REG
   07be   b5                phi R5
   07bf   15                inc R5
                            
   07c0   8f                glo STACK_REG
   07c1   fc 05             adi 5
   07c3   a7                plo R7
   07c4   9f                ghi STACK_REG
   07c5   7c 00             adci 0
   07c7   b7                phi R7
                            
   07c8   f8 d4             ldi INTEGER_DIV.0
   07ca   ad                plo CALL_REG
   07cb   f8 01             ldi INTEGER_DIV.1
   07cd   bd                phi CALL_REG
                            
   07ce   f8 00             ldi FCALL.0
   07d0   ae                plo FCALL_REG
   07d1   de                sep FCALL_REG
                            
   07d2   8f                glo STACK_REG
   07d3   fc 0b             adi 11
   07d5   a6                plo R6
   07d6   9f                ghi STACK_REG
   07d7   7c 00             adci 0
   07d9   b6                phi R6
                            
   07da   06                ldn R6
   07db   a4                plo R4
   07dc   16                inc R6
   07dd   06                ldn R6
   07de   b4                phi R4
                            
   07df   8f                glo STACK_REG
   07e0   fc 08             adi 8
   07e2   af                plo STACK_REG
   07e3   9f                ghi STACK_REG
   07e4   7c 00             adci 0
   07e6   bf                phi STACK_REG
                        
   07e7   c0 07 71          lbr TERM_MAIN
                            
   07ea                 TERM_MULTIPLY
   07ea   14                inc R4
                            
   07eb   f8 00             ldi 0
   07ed   73                stxd
   07ee   73                stxd
   07ef   73                stxd
   07f0   73                stxd
                            
   07f1   8f                glo STACK_REG
   07f2   a5                plo R5
   07f3   9f                ghi STACK_REG
   07f4   b5                phi R5
   07f5   15                inc R5
                            
   07f6   f8 b0             ldi FACTOR.0
   07f8   ad                plo CALL_REG
   07f9   f8 06             ldi FACTOR.1
   07fb   bd                phi CALL_REG
                            
   07fc   f8 00             ldi FCALL.0
   07fe   ae                plo FCALL_REG
   07ff   de                sep FCALL_REG
                            
   0800   8f                glo STACK_REG
   0801   fc 07             adi 7
   0803   a6                plo R6
   0804   9f                ghi STACK_REG
   0805   7c 00             adci 0
   0807   b6                phi R6
                            
   0808   84                glo R4
   0809   56                str R6
   080a   16                inc R6
   080b   94                ghi R4
   080c   56                str R6
                            
   080d   8f                glo STACK_REG
   080e   fc 05             adi 5
   0810   a8                plo R8
   0811   9f                ghi STACK_REG
   0812   7c 00             adci 0
   0814   b8                phi R8
                            
   0815   08                ldn R8
   0816   a4                plo R4
   0817   a6                plo R6
   0818   18                inc R8
   0819   08                ldn R8
   081a   b4                phi R4
   081b   b6                phi R6
                            
   081c   8f                glo STACK_REG
   081d   a5                plo R5
   081e   9f                ghi STACK_REG
   081f   b5                phi R5
   0820   15                inc R5
                            
   0821   f8 72             ldi INTEGER_MUL.0
   0823   ad                plo CALL_REG
   0824   f8 03             ldi INTEGER_MUL.1
   0826   bd                phi CALL_REG
                            
   0827   f8 00             ldi FCALL.0
   0829   ae                plo FCALL_REG
   082a   de                sep FCALL_REG
                            
   082b   8f                glo STACK_REG
   082c   fc 07             adi 7
   082e   a6                plo R6
   082f   9f                ghi STACK_REG
   0830   7c 00             adci 0
   0832   b6                phi R6
                            
   0833   06                ldn R6
   0834   a4                plo R4
   0835   16                inc R6
   0836   06                ldn R6
   0837   b4                phi R4
                            
   0838   1f                inc STACK_REG
   0839   1f                inc STACK_REG
   083a   1f                inc STACK_REG
   083b   1f                inc STACK_REG
                        
   083c   c0 07 71          lbr TERM_MAIN
                            
   083f                 TERM_NEXT_CYCLE
   083f   14                inc R4
   0840   c0 07 71          lbr TERM_MAIN
                            
   0843                 TERM_END
   0843   8f                glo STACK_REG
   0844   a6                plo R6
   0845   9f                ghi STACK_REG
   0846   b6                phi R6
   0847   16                inc R6
                            
   0848   46                lda R6
   0849   a5                plo R5
   084a   46                lda R6
   084b   b5                phi R5
                            
   084c   8f                glo STACK_REG
   084d   fc 04             adi 4
   084f   af                plo STACK_REG
   0850   9f                ghi STACK_REG
   0851   7c 00             adci 0
   0853   bf                phi STACK_REG
                            
   0854   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-EXPRESSION-----------------------------------
                        ;-R4-string pointer----------------------------
                        ;-R5-result pointer----------------------------
                        ;-Local registers------------------------------
                        ;-R6-R7----------------------------------------
   0855                 EXPRESSION
   0855   ef                sex STACK_REG
                            
   0856   97                ghi R7      ;saving local registers
   0857   73                stxd
   0858   87                glo R7
   0859   73                stxd
                            
   085a   96                ghi R6
   085b   73                stxd
   085c   86                glo R6
   085d   73                stxd
                            
   085e   94                ghi R4      ;R4 pointer to input string 
   085f   73                stxd
   0860   84                glo R4
   0861   73                stxd        ;+3 input string pointer
                            
   0862   95                ghi R5      ;R5 pointer to result
   0863   73                stxd
   0864   85                glo R5
   0865   73                stxd        ;+1 result pointer
                            
   0866                 EXPRESSION_SKIPSPACES           ;skip spaces
   0866   44                lda R4
   0867   fb 20             xri 32
   0869   32 66             bz EXPRESSION_SKIPSPACES
   086b   24                dec R4
                            
   086c   f8 5e             ldi TERM.0                  ;read TERM
   086e   ad                plo CALL_REG
   086f   f8 07             ldi TERM.1
   0871   bd                phi CALL_REG
                            
   0872   f8 00             ldi FCALL.0
   0874   ae                plo FCALL_REG
   0875   de                sep FCALL_REG
                            
   0876                 EXPRESSION_MAIN
   0876   04                ldn R4
   0877   fb 20             xri 32                      ;if ' '
   0879   c2 09 3b          lbz EXPRESSION_NEXT_CYCLE
   087c   04                ldn R4
   087d   fb 2b             xri 43                      ;if '+'
   087f   32 8a             bz EXPRESSION_ADD
   0881   04                ldn R4
   0882   fb 2d             xri 45                      ;if '-'
   0884   c2 08 e3          lbz EXPRESSION_SUB
                            
                            
   0887   c0 09 3f          lbr EXPRESSION_END
                            
   088a                 EXPRESSION_ADD
   088a   14                inc R4
                            
   088b   f8 00             ldi 0               ;new result
   088d   73                stxd
   088e   73                stxd
   088f   73                stxd
   0890   73                stxd
                            
   0891   8f                glo STACK_REG       ;set R5 pointer to new result
   0892   a5                plo R5
   0893   9f                ghi STACK_REG
   0894   b5                phi R5
   0895   15                inc R5
                            
   0896   f8 5e             ldi TERM.0          ;read TERM
   0898   ad                plo CALL_REG
   0899   f8 07             ldi TERM.1
   089b   bd                phi CALL_REG
                            
   089c   f8 00             ldi FCALL.0
   089e   ae                plo FCALL_REG
   089f   de                sep FCALL_REG
                            
   08a0   8f                glo STACK_REG       ; set R6 register to point to the input string pointer
   08a1   fc 07             adi 7
   08a3   a6                plo R6
   08a4   9f                ghi STACK_REG
   08a5   7c 00             adci 0
   08a7   b6                phi R6
                            
   08a8   84                glo R4              ;input string pointer = R4
   08a9   56                str R6
   08aa   16                inc R6
   08ab   94                ghi R4
   08ac   56                str R6
                            
   08ad   8f                glo STACK_REG       ;set R5 register to point to result
   08ae   a5                plo R5
   08af   9f                ghi STACK_REG
   08b0   b5                phi R5
   08b1   15                inc R5
                            
   08b2   8f                glo STACK_REG       ;set R6 register to point to the result pointer
   08b3   fc 05             adi 5
   08b5   a6                plo R6
   08b6   9f                ghi STACK_REG
   08b7   7c 00             adci 0
   08b9   b6                phi R6
                            
   08ba   06                ldn R6              ;R4 = result pointer
   08bb   a4                plo R4
   08bc   16                inc R6
   08bd   06                ldn R6
   08be   b4                phi R4
                            
   08bf   e4                sex R4
                            
   08c0   f8 02             ldi 2
   08c2   fe                shl
   08c3   a7                plo R7
                            
   08c4                 EXPRESSION_ADD_LOOP     ;*result pointer += result;
   08c4   05                ldn R5
   08c5   74                adc
   08c6   54                str R4
   08c7   15                inc R5
   08c8   60                irx
                            
   08c9   27                dec R7
   08ca   87                glo R7
   08cb   ca 08 c4          lbnz EXPRESSION_ADD_LOOP
                            
   08ce   ef                sex STACK_REG
                            
   08cf   8f                glo STACK_REG       
   08d0   fc 07             adi 7
   08d2   a6                plo R6
   08d3   9f                ghi STACK_REG
   08d4   7c 00             adci 0
   08d6   b6                phi R6
                            
   08d7   06                ldn R6              ;R4 = input string pointer
   08d8   a4                plo R4
   08d9   16                inc R6
   08da   06                ldn R6
   08db   b4                phi R4
                            
   08dc   1f                inc STACK_REG
   08dd   1f                inc STACK_REG
   08de   1f                inc STACK_REG
   08df   1f                inc STACK_REG
                        
   08e0   c0 08 76          lbr EXPRESSION_MAIN
                        
   08e3                 EXPRESSION_SUB
   08e3   14                inc R4
                            
   08e4   f8 00             ldi 0
   08e6   73                stxd
   08e7   73                stxd
   08e8   73                stxd
   08e9   73                stxd
                            
   08ea   8f                glo STACK_REG
   08eb   a5                plo R5
   08ec   9f                ghi STACK_REG
   08ed   b5                phi R5
   08ee   15                inc R5
                            
   08ef   f8 5e             ldi TERM.0
   08f1   ad                plo CALL_REG
   08f2   f8 07             ldi TERM.1
   08f4   bd                phi CALL_REG
                            
   08f5   f8 00             ldi FCALL.0
   08f7   ae                plo FCALL_REG
   08f8   de                sep FCALL_REG
                            
   08f9   8f                glo STACK_REG
   08fa   fc 07             adi 7
   08fc   a6                plo R6
   08fd   9f                ghi STACK_REG
   08fe   7c 00             adci 0
   0900   b6                phi R6
                            
   0901   84                glo R4
   0902   56                str R6
   0903   16                inc R6
   0904   94                ghi R4
   0905   56                str R6
                            
   0906   8f                glo STACK_REG
   0907   a5                plo R5
   0908   9f                ghi STACK_REG
   0909   b5                phi R5
   090a   15                inc R5
                            
   090b   8f                glo STACK_REG
   090c   fc 05             adi 5
   090e   a6                plo R6
   090f   9f                ghi STACK_REG
   0910   7c 00             adci 0
   0912   b6                phi R6
                            
   0913   06                ldn R6
   0914   a4                plo R4
   0915   16                inc R6
   0916   06                ldn R6
   0917   b4                phi R4
                            
   0918   e4                sex R4
                            
   0919   f8 82             ldi 082h
   091b   fe                shl
   091c   a7                plo R7
                            
   091d                 EXPRESSION_SUB_LOOP
   091d   05                ldn R5
   091e   75                sdb
   091f   54                str R4
   0920   15                inc R5
   0921   60                irx
                            
   0922   27                dec R7
   0923   87                glo R7
   0924   3a 1d             bnz EXPRESSION_SUB_LOOP
                            
   0926   ef                sex STACK_REG
                            
   0927   8f                glo STACK_REG
   0928   fc 07             adi 7
   092a   a6                plo R6
   092b   9f                ghi STACK_REG
   092c   7c 00             adci 0
   092e   b6                phi R6
                            
   092f   06                ldn R6
   0930   a4                plo R4
   0931   16                inc R6
   0932   06                ldn R6
   0933   b4                phi R4
                            
   0934   1f                inc STACK_REG
   0935   1f                inc STACK_REG
   0936   1f                inc STACK_REG
   0937   1f                inc STACK_REG
                        
   0938   c0 08 76          lbr EXPRESSION_MAIN
                        
   093b                 EXPRESSION_NEXT_CYCLE    
   093b   14                inc R4
   093c   c0 08 76          lbr EXPRESSION_MAIN
                            
   093f                 EXPRESSION_END
   093f   ef                sex STACK_REG
   0940   60                irx
                            
   0941   72                ldxa            ;restoring registers
   0942   a5                plo R5
   0943   72                ldxa
   0944   b5                phi R5
   0945   60                irx
   0946   60                irx
   0947   72                ldxa
   0948   a6                plo R6
   0949   72                ldxa
   094a   b6                phi R6
   094b   72                ldxa
   094c   a7                plo R7
   094d   f0                ldx
   094e   b7                phi R7
                            
   094f   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-DYN MEMORY INIT------------------------------
   0950                 DYN_MEMORY_INIT
   0950   f8 06             ldi HEAP_LASTADDRESS.0
   0952   a4                plo R4
   0953   f8 21             ldi HEAP_LASTADDRESS.1
   0955   b4                phi R4
                            
   0956   f8 10             ldi HEAP_START.0
   0958   54                str R4
   0959   14                inc R4
   095a   f8 21             ldi HEAP_START.1
   095c   54                str R4
                            
   095d   f8 10             ldi HEAP_START.0
   095f   a4                plo R4
   0960   f8 21             ldi HEAP_START.1
   0962   b4                phi R4
                            
   0963   f8 eb             ldi (HEAP_END - HEAP_START - 5).0
   0965   54                str R4
   0966   14                inc R4
   0967   f8 da             ldi (HEAP_END - HEAP_START - 5).1
   0969   54                str R4
   096a   14                inc R4
                            
   096b   f8 00             ldi 0
   096d   54                str R4
   096e   14                inc R4
   096f   54                str R4
   0970   14                inc R4
   0971   54                str R4
                            
   0972   de                sep RETURN
                        ;----------------------------------------------
                        
   0973                 DYN_MEMORY_DEBUG_STR
   0973   20 2d 3e 20       db " -> size: ",0,", address: ",0,", previous: ",0,", ",0
   0977   73 69 7a 65   
   097b   3a 20 00 2c   
   097f   20 61 64 64   
   0983   72 65 73 73   
   0987   3a 20 00 2c   
   098b   20 70 72 65   
   098f   76 69 6f 75   
   0993   73 3a 20 00   
   0997   2c 20 00      
   099a                 DYN_MEMORY_DEBUG_STR_FREE
   099a   46 52 45 45       db "FREE\r\n",0
   099e   0d 0a 00      
   09a1                 DYN_MEMORY_DEBUG_STR_USED
   09a1   55 53 45 44       db "USED\r\n",0
   09a5   0d 0a 00      
                        ;-DYN MEMORY DEBUG-----------------------------
   09a8                 DYN_MEMORY_DEBUG
   09a8   ef                sex STACK_REG
                            
   09a9   f8 00             ldi 0
   09ab   73                stxd
   09ac   73                stxd
   09ad   73                stxd
   09ae   73                stxd                    ;+14 address + 5
                            
   09af   73                stxd
   09b0   73                stxd
   09b1   f8 21             ldi HEAP_START.1
   09b3   73                stxd
   09b4   f8 10             ldi HEAP_START.0
   09b6   73                stxd                    ;+10 address
                            
   09b7   f8 00             ldi 0
   09b9   73                stxd                    ;+9 used
                            
   09ba   73                stxd
   09bb   73                stxd
   09bc   73                stxd
   09bd   73                stxd                    ;+5 previous
                            
   09be   73                stxd
   09bf   73                stxd
   09c0   73                stxd
   09c1   73                stxd                    ;+1 size
                            
   09c2                 DYN_MEMORY_DEBUG_MAINLOOP
   09c2   8f                glo STACK_REG
   09c3   fc 0a             adi 10
   09c5   a4                plo R4
   09c6   9f                ghi STACK_REG
   09c7   7c 00             adci 0
   09c9   b4                phi R4
                            
   09ca   e4                sex R4
                            
   09cb   f8 00             ldi HEAP_END.0
   09cd   f5                sd
   09ce   14                inc R4
   09cf   f8 fc             ldi HEAP_END.1
   09d1   75                sdb
                            
   09d2   c3 0a de          lbdf DYN_MEMORY_DEBUG_END    ;if address >= HEAP_END
                            
   09d5   8f                glo STACK_REG
   09d6   fc 0a             adi 10
   09d8   a4                plo R4
   09d9   9f                ghi STACK_REG
   09da   7c 00             adci 0
   09dc   b4                phi R4
                            
   09dd   44                lda R4                      ;R5 = address
   09de   a5                plo R5
   09df   44                lda R4
   09e0   b5                phi R5
                            
   09e1   8f                glo STACK_REG
   09e2   a4                plo R4
   09e3   9f                ghi STACK_REG
   09e4   b4                phi R4
   09e5   14                inc R4
                            
   09e6   45                lda R5
   09e7   54                str R4
   09e8   14                inc R4
                            
   09e9   45                lda R5
   09ea   54                str R4
   09eb   14                inc R4
                            
   09ec   14                inc R4
   09ed   14                inc R4
                            
   09ee   45                lda R5
   09ef   54                str R4
   09f0   14                inc R4
                            
   09f1   45                lda R5
   09f2   54                str R4
   09f3   14                inc R4
                            
   09f4   14                inc R4
   09f5   14                inc R4
                            
   09f6   45                lda R5
   09f7   54                str R4
                            
   09f8   8f                glo STACK_REG
   09f9   fc 0e             adi 14
   09fb   a4                plo R4
   09fc   9f                ghi STACK_REG
   09fd   7c 00             adci 0
   09ff   b4                phi R4
                            
   0a00   85                glo R5
   0a01   54                str R4
   0a02   14                inc R4
                            
   0a03   95                ghi R5
   0a04   54                str R4
                            
   0a05                 DYN_MEMORY_DEBUG_PRINT
   0a05   8f                glo STACK_REG               ;set R4 to address
   0a06   fc 0a             adi 10
   0a08   a4                plo R4
   0a09   9f                ghi STACK_REG
   0a0a   7c 00             adci 0
   0a0c   b4                phi R4
                        
   0a0d   f8 ae             ldi PRINT_DEC.0             ;print address in decimal
   0a0f   ad                plo CALL_REG
   0a10   f8 04             ldi PRINT_DEC.1
   0a12   bd                phi CALL_REG
                            
   0a13   f8 00             ldi FCALL.0
   0a15   ae                plo FCALL_REG
   0a16   de                sep FCALL_REG
                            
   0a17   f8 73             ldi DYN_MEMORY_DEBUG_STR.0      ;print the debug string
   0a19   a6                plo R6
   0a1a   f8 09             ldi DYN_MEMORY_DEBUG_STR.1
   0a1c   b6                phi R6
                            
   0a1d   f8 52             ldi PRINT.0         ;prepare to call PRINT
   0a1f   ad                plo CALL_REG
   0a20   f8 01             ldi PRINT.1
   0a22   bd                phi CALL_REG
                            
   0a23   f8 00             ldi FCALL.0
   0a25   ae                plo FCALL_REG
   0a26   de                sep FCALL_REG       ;call PRINT
                            
   0a27   86                glo R6                  ;save R6 value
   0a28   a7                plo R7
   0a29   96                ghi R6
   0a2a   b7                phi R7
                            
   0a2b   8f                glo STACK_REG           ;set R4 to size
   0a2c   a4                plo R4
   0a2d   9f                ghi STACK_REG
   0a2e   b4                phi R4
   0a2f   14                inc R4
                        
   0a30   f8 ae             ldi PRINT_DEC.0         ;print size in decimal
   0a32   ad                plo CALL_REG
   0a33   f8 04             ldi PRINT_DEC.1
   0a35   bd                phi CALL_REG
                            
   0a36   f8 00             ldi FCALL.0
   0a38   ae                plo FCALL_REG
   0a39   de                sep FCALL_REG
                            
   0a3a   87                glo R7                  ;continue printing the debug string
   0a3b   a6                plo R6
   0a3c   97                ghi R7
   0a3d   b6                phi R6
                            
   0a3e   f8 52             ldi PRINT.0             ;prepare to call PRINT
   0a40   ad                plo CALL_REG
   0a41   f8 01             ldi PRINT.1
   0a43   bd                phi CALL_REG
                            
   0a44   f8 00             ldi FCALL.0
   0a46   ae                plo FCALL_REG
   0a47   de                sep FCALL_REG           ;call PRINT
                            
   0a48   86                glo R6                  ;save R6 value
   0a49   a7                plo R7
   0a4a   96                ghi R6
   0a4b   b7                phi R7
                            
   0a4c   8f                glo STACK_REG           ;set R4 to address+5
   0a4d   fc 0e             adi 14
   0a4f   a4                plo R4
   0a50   9f                ghi STACK_REG
   0a51   7c 00             adci 0
   0a53   b4                phi R4
                            
   0a54   f8 ae             ldi PRINT_DEC.0         ;print address+5 in decimal
   0a56   ad                plo CALL_REG
   0a57   f8 04             ldi PRINT_DEC.1
   0a59   bd                phi CALL_REG
                            
   0a5a   f8 00             ldi FCALL.0
   0a5c   ae                plo FCALL_REG
   0a5d   de                sep FCALL_REG
                            
   0a5e   87                glo R7                  ;continue printing the debug string
   0a5f   a6                plo R6
   0a60   97                ghi R7
   0a61   b6                phi R6
                            
   0a62   f8 52             ldi PRINT.0             ;prepare to call PRINT
   0a64   ad                plo CALL_REG
   0a65   f8 01             ldi PRINT.1
   0a67   bd                phi CALL_REG
                            
   0a68   f8 00             ldi FCALL.0
   0a6a   ae                plo FCALL_REG
   0a6b   de                sep FCALL_REG           ;call PRINT
                            
   0a6c   86                glo R6                  ;save R6 value
   0a6d   a7                plo R7
   0a6e   96                ghi R6
   0a6f   b7                phi R7
                            
   0a70   8f                glo STACK_REG           ;set R4 to previous
   0a71   fc 05             adi 5
   0a73   a4                plo R4
   0a74   9f                ghi STACK_REG
   0a75   7c 00             adci 0
   0a77   b4                phi R4
                            
   0a78   f8 ae             ldi PRINT_DEC.0         ;print previous in decimal
   0a7a   ad                plo CALL_REG
   0a7b   f8 04             ldi PRINT_DEC.1
   0a7d   bd                phi CALL_REG
                            
   0a7e   f8 00             ldi FCALL.0
   0a80   ae                plo FCALL_REG
   0a81   de                sep FCALL_REG
                            
   0a82   87                glo R7                  ;continue printing the debug string
   0a83   a6                plo R6
   0a84   97                ghi R7
   0a85   b6                phi R6
                            
   0a86   f8 52             ldi PRINT.0             ;prepare to call PRINT
   0a88   ad                plo CALL_REG
   0a89   f8 01             ldi PRINT.1
   0a8b   bd                phi CALL_REG
                            
   0a8c   f8 00             ldi FCALL.0
   0a8e   ae                plo FCALL_REG
   0a8f   de                sep FCALL_REG           ;call PRINT
                            
   0a90   8f                glo STACK_REG           ;set R4 to previous
   0a91   fc 09             adi 9
   0a93   a4                plo R4
   0a94   9f                ghi STACK_REG
   0a95   7c 00             adci 0
   0a97   b4                phi R4
                            
   0a98   04                ldn R4
   0a99   32 a3             bz DYN_MEMORY_DEBUG_FREE
                            
   0a9b   f8 a1             ldi DYN_MEMORY_DEBUG_STR_USED.0
   0a9d   a6                plo R6
   0a9e   f8 09             ldi DYN_MEMORY_DEBUG_STR_USED.1
   0aa0   b6                phi R6
                            
   0aa1   30 a9             br DYN_MEMORY_DEBUG_NEXTADDRESS
                            
   0aa3                 DYN_MEMORY_DEBUG_FREE
   0aa3   f8 9a             ldi DYN_MEMORY_DEBUG_STR_FREE.0
   0aa5   a6                plo R6
   0aa6   f8 09             ldi DYN_MEMORY_DEBUG_STR_FREE.1
   0aa8   b6                phi R6
                            
   0aa9                 DYN_MEMORY_DEBUG_NEXTADDRESS
   0aa9   f8 52             ldi PRINT.0             ;prepare to call PRINT
   0aab   ad                plo CALL_REG
   0aac   f8 01             ldi PRINT.1
   0aae   bd                phi CALL_REG
                            
   0aaf   f8 00             ldi FCALL.0
   0ab1   ae                plo FCALL_REG
   0ab2   de                sep FCALL_REG           ;call PRINT
                            
   0ab3   8f                glo STACK_REG           ;set R4 to address
   0ab4   fc 0a             adi 10
   0ab6   a4                plo R4
   0ab7   9f                ghi STACK_REG
   0ab8   7c 00             adci 0
   0aba   b4                phi R4
                            
   0abb   8f                glo STACK_REG           ;set R5 to address+5
   0abc   fc 0e             adi 14
   0abe   a5                plo R5
   0abf   9f                ghi STACK_REG
   0ac0   7c 00             adci 0
   0ac2   b5                phi R5
                            
   0ac3   8f                glo STACK_REG           ;set R6 to size
   0ac4   a6                plo R6
   0ac5   9f                ghi STACK_REG
   0ac6   b6                phi R6
   0ac7   16                inc R6
                            
   0ac8   e6                sex R6
                            
   0ac9   45                lda R5
   0aca   f4                add
   0acb   60                irx
   0acc   54                str R4
   0acd   14                inc R4
                            
   0ace   45                lda R5
   0acf   74                adc
   0ad0   60                irx
   0ad1   54                str R4
   0ad2   14                inc R4
                            
   0ad3   45                lda R5
   0ad4   74                adc
   0ad5   60                irx
   0ad6   54                str R4
   0ad7   14                inc R4
                            
   0ad8   45                lda R5
   0ad9   74                adc
   0ada   54                str R4
                            
   0adb   c0 09 c2          lbr DYN_MEMORY_DEBUG_MAINLOOP
                        
   0ade                 DYN_MEMORY_DEBUG_END
   0ade   8f                glo STACK_REG           ;set R6 to size
   0adf   fc 11             adi 17
   0ae1   af                plo STACK_REG
   0ae2   9f                ghi STACK_REG
   0ae3   7c 00             adci 0
   0ae5   bf                phi STACK_REG
                            
   0ae6   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-DYN MEMORY ALLOCATION------------------------
                        ;-R4-Size--------------------------------------
                        ;-R10-return address---------------------------
                        ;-Local registers------------------------------
                        ;-R5-R6-R7-R8----------------------------------
   0ae7                 DYN_MEMORY_ALLOC
   0ae7   ef                sex STACK_REG
                            
   0ae8   98                ghi R8
   0ae9   73                stxd
   0aea   88                glo R8
   0aeb   73                stxd
                            
   0aec   97                ghi R7
   0aed   73                stxd
   0aee   87                glo R7
   0aef   73                stxd
                            
   0af0   96                ghi R6
   0af1   73                stxd
   0af2   86                glo R6
   0af3   73                stxd
                            
   0af4   95                ghi R5
   0af5   73                stxd
   0af6   85                glo R5
   0af7   73                stxd
                            
   0af8   f8 00             ldi 0
   0afa   73                stxd
   0afb   73                stxd                ;+7 currentSize
                            
   0afc   94                ghi R4
   0afd   73                stxd
   0afe   84                glo R4
   0aff   73                stxd                ;+5 size
                            
   0b00   84                glo R4              ;R4 += 5
   0b01   fc 05             adi 5
   0b03   a4                plo R4
   0b04   94                ghi R4
   0b05   7c 00             adci 0
   0b07   b4                phi R4
                            
   0b08   94                ghi R4
   0b09   73                stxd
   0b0a   84                glo R4              ;newSize is initialized to size+5 for further calculation
   0b0b   73                stxd                ;+3 newSize
                        
   0b0c   f8 fc             ldi HEAP_END.1
   0b0e   73                stxd
   0b0f   f8 00             ldi HEAP_END.0
   0b11   73                stxd                ;+1 endAddress = HEAP_END
                            
   0b12   f8 06             ldi HEAP_LASTADDRESS.0
   0b14   a4                plo R4
   0b15   f8 21             ldi HEAP_LASTADDRESS.1
   0b17   b4                phi R4
                            
   0b18   44                lda R4
   0b19   a5                plo R5
   0b1a   44                lda R4
   0b1b   b5                phi R5              ;R5 = lastAddress
                            
   0b1c   f8 00             ldi 0               ;R10 = 0
   0b1e   aa                plo R10
   0b1f   ba                phi R10
                            
   0b20   f8 02             ldi 2               ;R8 = 2
   0b22   a8                plo R8
                            
   0b23                 DYN_MEMORY_ALLOC_MAINLOOP
   0b23   8f                glo STACK_REG       ;set R4 pointer to endAddress
   0b24   a4                plo R4
   0b25   9f                ghi STACK_REG
   0b26   b4                phi R4
   0b27   14                inc R4
                            
   0b28   e4                sex R4
                            
   0b29   85                glo R5              ;currentAddress - endAddress
   0b2a   f7                sm
   0b2b   60                irx
   0b2c   95                ghi R5
   0b2d   77                smb
                            
   0b2e   c3 0c 15          lbdf DYN_MEMORY_ALLOC_NEXTPASS      ;if currentAddress >= endAddress
                            
   0b31   8f                glo STACK_REG                       ;set R4 pointer to currentSize
   0b32   fc 07             adi 7
   0b34   a4                plo R4
   0b35   9f                ghi STACK_REG
   0b36   7c 00             adci 0
   0b38   b4                phi R4
                            
   0b39   85                glo R5                              ;R6 = R5 (currentAddress)
   0b3a   a6                plo R6
   0b3b   95                ghi R5
   0b3c   b6                phi R6
                            
   0b3d   46                lda R6                              ;currentSize = block size
   0b3e   54                str R4
   0b3f   14                inc R4
                            
   0b40   46                lda R6
   0b41   54                str R4
                            
   0b42   16                inc R6
   0b43   16                inc R6
                                
   0b44   06                ldn R6
   0b45   ca 0b fb          lbnz DYN_MEMORY_ALLOC_NEXTADDRESS   ;if the current block is USED
                            
   0b48   24                dec R4
                            
   0b49   8f                glo STACK_REG                   ;R6 pointer set to size
   0b4a   fc 05             adi 5
   0b4c   a6                plo R6
   0b4d   9f                ghi STACK_REG
   0b4e   7c 00             adci 0
   0b50   b6                phi R6
                            
   0b51   46                lda R6                          ;currentSize == size
   0b52   f3                xor
   0b53   60                irx
   0b54   e6                sex R6
   0b55   f1                or
   0b56   e4                sex R4
   0b57   f3                xor
                            
   0b58   26                dec R6                              ;set back R6
   0b59   24                dec R4                              ;set back R4
                            
   0b5a   ca 0b 70          lbnz DYN_MEMORY_ALLOC_SIZEBIGGER    ;if currentSize != size
                        
   0b5d                 DYN_MEMORY_ALLOC_SIZEEQ
   0b5d   85                glo R5                              ;R6 = currentAddress + 4
   0b5e   fc 04             adi 4
   0b60   a6                plo R6
   0b61   95                ghi R5
   0b62   7c 00             adci 0
   0b64   b6                phi R6
                            
   0b65   f8 01             ldi 1
   0b67   56                str R6                              ;used = 1
                            
   0b68   16                inc R6                              ;R6++
   0b69   86                glo R6
   0b6a   aa                plo R10                             ;R10 = R6
   0b6b   96                ghi R6
   0b6c   ba                phi R10
                            
   0b6d   c0 0c 30          lbr DYN_MEMORY_ALLOC_END            ;RETURN
                        
   0b70                 DYN_MEMORY_ALLOC_SIZEBIGGER
   0b70   8f                glo STACK_REG                   ;R6 pinter set to newSize (size+5)
   0b71   fc 03             adi 3
   0b73   a6                plo R6
   0b74   9f                ghi STACK_REG
   0b75   7c 00             adci 0
   0b77   b6                phi R6
                            
   0b78   46                lda R6                          ;currentSize - newSize (size+5)
   0b79   f5                sd
   0b7a   60                irx
   0b7b   46                lda R6
   0b7c   75                sdb
                            
   0b7d   26                dec R6                              ;set back R6
   0b7e   26                dec R6
                               
   0b7f   cb 0b fb          lbnf DYN_MEMORY_ALLOC_NEXTADDRESS   ;if currentSize < newSize (size+5)
                            
   0b82   24                dec R4                              ;R4 pointer to size
   0b83   24                dec R4
   0b84   24                dec R4
                            
   0b85   85                glo R5                              ;R6 = R5 (currentAddress)
   0b86   a6                plo R6
   0b87   95                ghi R5
   0b88   b6                phi R6
                            
   0b89   44                lda R4                              ;set current block size to size
   0b8a   56                str R6
   0b8b   16                inc R6
                            
   0b8c   44                lda R4
   0b8d   56                str R6
   0b8e   16                inc R6
                            
   0b8f   16                inc R6                              ;R6 += 2
   0b90   16                inc R6
                            
   0b91   f8 01             ldi 1                               ;set used to 1
   0b93   56                str R6
                            
   0b94   16                inc R6                              ;R6++
   0b95   86                glo R6
   0b96   aa                plo R10                             ;R10 = R6
   0b97   96                ghi R6                              ;R10 is set for return
   0b98   ba                phi R10
                            
   0b99   8f                glo STACK_REG                   ;R4 pinter set to newSize (size+5)
   0b9a   fc 03             adi 3
   0b9c   a4                plo R4
   0b9d   9f                ghi STACK_REG
   0b9e   7c 00             adci 0
   0ba0   b4                phi R4
                            
   0ba1   85                glo R5                          ;R7 = currentAddress + size + 5
   0ba2   f4                add
   0ba3   60                irx
   0ba4   a7                plo R7
   0ba5   95                ghi R5
   0ba6   74                adc
   0ba7   b7                phi R7                          ;R7 is the newAddress
                            
   0ba8   f8 06             ldi HEAP_LASTADDRESS.0
   0baa   a4                plo R4
   0bab   f8 21             ldi HEAP_LASTADDRESS.1
   0bad   b4                phi R4
                            
   0bae   87                glo R7                          ;lastAddress = R7
   0baf   54                str R4
   0bb0   14                inc R4
                            
   0bb1   97                ghi R7
   0bb2   54                str R4
                        
   0bb3   8f                glo STACK_REG                   ;R4 pinter set to newSize
   0bb4   fc 03             adi 3
   0bb6   a4                plo R4
   0bb7   9f                ghi STACK_REG
   0bb8   7c 00             adci 0
   0bba   b4                phi R4
                            
   0bbb   8f                glo STACK_REG                   ;R4 pinter set to currentSize
   0bbc   fc 07             adi 7
   0bbe   a6                plo R6
   0bbf   9f                ghi STACK_REG
   0bc0   7c 00             adci 0
   0bc2   b6                phi R6
                            
   0bc3   46                lda R6                          ;newSize = currentSize - (size + 5)
   0bc4   f7                sm
   0bc5   54                str R4
   0bc6   60                irx
                            
   0bc7   46                lda R6
   0bc8   77                smb
   0bc9   54                str R4
                            
   0bca   24                dec R4                          ;set back R4 to newSize
                            
   0bcb   87                glo R7                          ;R6 = R7 (newAddress)
   0bcc   a6                plo R6
   0bcd   97                ghi R7
   0bce   b6                phi R6
                            
   0bcf   44                lda R4                          ;new block size = newSize
   0bd0   56                str R6
   0bd1   16                inc R6
                            
   0bd2   44                lda R4
   0bd3   56                str R6
   0bd4   16                inc R6
                            
   0bd5   85                glo R5                          ;new block previous address = currentAddress
   0bd6   56                str R6
   0bd7   16                inc R6
                            
   0bd8   95                ghi R5
   0bd9   56                str R6
   0bda   16                inc R6
                            
   0bdb   f8 00             ldi 0                           ;new block used = 0
   0bdd   56                str R6
   0bde   16                inc R6
                            
   0bdf   24                dec R4
   0be0   24                dec R4
                            
   0be1   86                glo R6                          ;R6 = R6 + newSize
   0be2   f4                add
   0be3   60                irx
   0be4   a6                plo R6
   0be5   96                ghi R6
   0be6   74                adc
   0be7   b6                phi R6
                            
   0be8   16                inc R6                          ;R6 += 2
   0be9   16                inc R6
                            
   0bea   86                glo R6
   0beb   ff 00             smi HEAP_END.0
   0bed   96                ghi R6
   0bee   7f fc             smbi HEAP_END.1
                            
   0bf0   c3 0c 30          lbdf DYN_MEMORY_ALLOC_END
                            
   0bf3   87                glo R7                          ;next block previous address = R7
   0bf4   56                str R6
   0bf5   16                inc R6
                            
   0bf6   97                ghi R7
   0bf7   56                str R6
                            
   0bf8   c0 0c 30          lbr DYN_MEMORY_ALLOC_END
                            
   0bfb                 DYN_MEMORY_ALLOC_NEXTADDRESS
   0bfb   8f                glo STACK_REG               ;set R4 pointer to currentSize
   0bfc   fc 07             adi 7
   0bfe   a4                plo R4
   0bff   9f                ghi STACK_REG
   0c00   7c 00             adci 0
   0c02   b4                phi R4
                            
   0c03   85                glo R5
   0c04   f4                add
   0c05   60                irx
   0c06   a5                plo R5
   0c07   95                ghi R5
   0c08   74                adc
   0c09   b5                phi R5                          ;currentAddress += size
                            
   0c0a   85                glo R5
   0c0b   fc 05             adi 5
   0c0d   a5                plo R5
   0c0e   95                ghi R5
   0c0f   7c 00             adci 0
   0c11   b5                phi R5                          ;currentAddress += 5
                            
   0c12   c0 0b 23          lbr DYN_MEMORY_ALLOC_MAINLOOP
                            
   0c15                 DYN_MEMORY_ALLOC_NEXTPASS
   0c15   f8 10             ldi HEAP_START.0
   0c17   a5                plo R5
   0c18   f8 21             ldi HEAP_START.1
   0c1a   b5                phi R5
                            
   0c1b   8f                glo STACK_REG                       ;set R4 pointer to endAddress
   0c1c   a4                plo R4
   0c1d   9f                ghi STACK_REG
   0c1e   b4                phi R4
   0c1f   14                inc R4
                            
   0c20   f8 06             ldi HEAP_LASTADDRESS.0
   0c22   a6                plo R6
   0c23   f8 21             ldi HEAP_LASTADDRESS.1
   0c25   b6                phi R6
                            
   0c26   46                lda R6
   0c27   54                str R4
   0c28   14                inc R4
                            
   0c29   46                lda R6
   0c2a   54                str R4
                        
   0c2b   28                dec R8
   0c2c   88                glo R8
   0c2d   ca 0b 23          lbnz DYN_MEMORY_ALLOC_MAINLOOP
                            
   0c30                 DYN_MEMORY_ALLOC_END
   0c30   8f                glo STACK_REG
   0c31   fc 09             adi 9
   0c33   af                plo STACK_REG
   0c34   9f                ghi STACK_REG
   0c35   7c 00             adci 0
   0c37   bf                phi STACK_REG
                            
   0c38   ef                sex STACK_REG
                            
   0c39   72                ldxa
   0c3a   a5                plo R5
   0c3b   72                ldxa
   0c3c   b5                phi R5
                            
   0c3d   72                ldxa
   0c3e   a6                plo R6
   0c3f   72                ldxa
   0c40   b6                phi R6
                            
   0c41   72                ldxa
   0c42   a7                plo R7
   0c43   72                ldxa
   0c44   b7                phi R7
                            
   0c45   72                ldxa
   0c46   a8                plo R8
   0c47   f0                ldx
   0c48   b8                phi R8
                            
   0c49   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-DYN MEMORY FREE------------------------------
                        ;-R4-address-----------------------------------
                        ;-Local registers------------------------------
                        ;-R5-R6----------------------------------------
   0c4a                 DYN_MEMORY_FREE
   0c4a   ef                sex STACK_REG
                            
   0c4b   95                ghi R5      ;saving local registers
   0c4c   73                stxd
   0c4d   85                glo R5
   0c4e   73                stxd
                            
   0c4f   96                ghi R6
   0c50   73                stxd
   0c51   86                glo R6
   0c52   73                stxd
                            
   0c53   f8 00             ldi 0
   0c55   73                stxd
   0c56   73                stxd
   0c57   73                stxd
   0c58   73                stxd        ;+5 size
                            
   0c59   73                stxd
   0c5a   73                stxd
   0c5b   73                stxd
   0c5c   73                stxd        ;+1 nextSize
                            
   0c5d   24                dec R4      ;R4-- (address--)
   0c5e   54                str R4      ;set current block to free
                            
   0c5f   24                dec R4
   0c60   24                dec R4
                            
   0c61   44                lda R4      ;R6 = previous block address
   0c62   a6                plo R6
   0c63   44                lda R4
   0c64   b6                phi R6
                            
   0c65   24                dec R4      ;set R4 to the beginning of the current block
   0c66   24                dec R4
   0c67   24                dec R4
   0c68   24                dec R4
                            
   0c69   86                glo R6
   0c6a   ca 0c 73          lbnz DYN_MEMORY_FREE_NEXTCHECK
   0c6d   96                ghi R6
   0c6e   ca 0c 73          lbnz DYN_MEMORY_FREE_NEXTCHECK      ;if previousAddress != 0
                            
   0c71   30 82             br DYN_MEMORY_FREE_MERGE
                        
   0c73                 DYN_MEMORY_FREE_NEXTCHECK
   0c73   86                glo R6                              ;set R5 pointer to previous block used
   0c74   fc 04             adi 4
   0c76   a5                plo R5
   0c77   96                ghi R6
   0c78   7c 00             adci 0
   0c7a   b5                phi R5
                            
   0c7b   05                ldn R5
   0c7c   3a 82             bnz DYN_MEMORY_FREE_MERGE           ;if used != 0
                            
   0c7e   86                glo R6                              ;set R4 to previous block
   0c7f   a4                plo R4
   0c80   96                ghi R6
   0c81   b4                phi R4
                            
   0c82                 DYN_MEMORY_FREE_MERGE
   0c82   8f                glo STACK_REG                       ;set R5 pointer to size
   0c83   fc 05             adi 5
   0c85   a5                plo R5
   0c86   9f                ghi STACK_REG
   0c87   7c 00             adci 0
   0c89   b5                phi R5
                            
   0c8a   e5                sex R5                              ;set R5 to pointer
                            
   0c8b   44                lda R4                              ;load block size to size
   0c8c   55                str R5
   0c8d   15                inc R5
                            
   0c8e   44                lda R4
   0c8f   55                str R5
                            
   0c90   24                dec R4
   0c91   24                dec R4                              ;set back R4 and R5
   0c92   25                dec R5
                            
   0c93   84                glo R4                              ;R6 (nextAddress) = address + 5 
   0c94   fc 05             adi 5
   0c96   a6                plo R6
   0c97   94                ghi R4
   0c98   7c 00             adci 0
   0c9a   b6                phi R6
                            
   0c9b   86                glo R6                              ;R6 += size
   0c9c   f4                add
   0c9d   60                irx
   0c9e   a6                plo R6
   0c9f   96                ghi R6
   0ca0   74                adc
   0ca1   b6                phi R6
                            
   0ca2                 DYN_MEMORY_FREE_MERGELOOP
   0ca2   86                glo R6
   0ca3   ff 00             smi HEAP_END.0
   0ca5   96                ghi R6
   0ca6   7f fc             smbi HEAP_END.1
                            
   0ca8   c3 0c e1          lbdf DYN_MEMORY_FREE_END            ;if nextAddress - HEAP_END >= 0
                            
   0cab   86                glo R6                              ;set R5 to nextAddress used
   0cac   fc 04             adi 4
   0cae   a5                plo R5
   0caf   96                ghi R6
   0cb0   7c 00             adci 0
   0cb2   b5                phi R5
                            
   0cb3   05                ldn R5
   0cb4   ca 0c da          lbnz DYN_MEMORY_FREE_SETPREVIOUS    ;if used != 0
                            
   0cb7   8f                glo STACK_REG                       ;set R5 pointer to nextSize
   0cb8   a5                plo R5
   0cb9   9f                ghi STACK_REG
   0cba   b5                phi R5
   0cbb   15                inc R5
                            
   0cbc   46                lda R6                              ;load size + 5 to nextSize 
   0cbd   fc 05             adi 5
   0cbf   55                str R5
   0cc0   60                irx
                            
   0cc1   06                ldn R6
   0cc2   7c 00             adci 0
   0cc4   55                str R5
                            
   0cc5   25                dec R5                              ;set back R5 and R6
   0cc6   26                dec R6
                            
   0cc7   04                ldn R4                              ;current block size += nextSize
   0cc8   f4                add
   0cc9   54                str R4
   0cca   60                irx
   0ccb   14                inc R4
                            
   0ccc   04                ldn R4
   0ccd   74                adc
   0cce   54                str R4
                            
   0ccf   25                dec R5                              ;set back R4 and R5
   0cd0   24                dec R4
                            
   0cd1   86                glo R6                              ;R6 (nextAddress) += nextSize
   0cd2   f4                add
   0cd3   a6                plo R6
   0cd4   60                irx
   0cd5   96                ghi R6
   0cd6   74                adc
   0cd7   b6                phi R6
                            
   0cd8   30 a2             br DYN_MEMORY_FREE_MERGELOOP
                        
   0cda                 DYN_MEMORY_FREE_SETPREVIOUS    
   0cda   16                inc R6                              ;increment nextAddress to previous address section
   0cdb   16                inc R6
                            
   0cdc   84                glo R4                              ;set previous address to R4 value
   0cdd   56                str R6
   0cde   16                inc R6
   0cdf   94                ghi R4
   0ce0   56                str R6
                        
   0ce1                 DYN_MEMORY_FREE_END
   0ce1   8f                glo STACK_REG
   0ce2   fc 09             adi 9
   0ce4   af                plo STACK_REG
   0ce5   9f                ghi STACK_REG
   0ce6   7c 00             adci 0
   0ce8   bf                phi STACK_REG
                            
   0ce9   ef                sex STACK_REG
                            
   0cea   f8 06             ldi HEAP_LASTADDRESS.0
   0cec   a5                plo R5
   0ced   f8 21             ldi HEAP_LASTADDRESS.1
   0cef   b5                phi R5
                            
   0cf0   84                glo R4
   0cf1   55                str R5
   0cf2   15                inc R5
                            
   0cf3   94                ghi R4
   0cf4   55                str R5
                            
   0cf5   72                ldxa            ;restoring local registers
   0cf6   a6                plo R6
   0cf7   72                ldxa
   0cf8   b6                phi R6
                            
   0cf9   72                ldxa
   0cfa   a5                plo R5
   0cfb   f0                ldx
   0cfc   b5                phi R5
                            
   0cfd   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-VAR-LIST-INIT--------------------------------
   0cfe                 VAR_LIST_INIT
   0cfe   f8 00             ldi VARLIST_COUNT.0
   0d00   a4                plo R4
   0d01   f8 21             ldi VARLIST_COUNT.1
   0d03   b4                phi R4
                            
   0d04   f8 06             ldi 6
   0d06   a5                plo R5
                        
   0d07                 VAR_LIST_INIT_LOOP
   0d07   f8 00             ldi 0
   0d09   54                str R4
   0d0a   14                inc R4
                            
   0d0b   25                dec R5
   0d0c   85                glo R5
   0d0d   3a 07             bnz VAR_LIST_INIT_LOOP
                            
   0d0f   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-GET-STRING-----------------------------------
                        ;-R4-Input string------------------------------
                        ;-R10-New string address-----------------------
                        ;-Local registers------------------------------
                        ;-R5-R6----------------------------------------
   0d10                 GET_STRING
   0d10   ef                sex STACK_REG
                            
   0d11   95                ghi R5
   0d12   73                stxd
   0d13   85                glo R5
   0d14   73                stxd
                            
   0d15   96                ghi R6
   0d16   73                stxd
   0d17   86                glo R6
   0d18   73                stxd
                            
   0d19   94                ghi R4
   0d1a   73                stxd
   0d1b   84                glo R4
   0d1c   73                stxd                    ;+1 startAddress
                            
   0d1d   f8 00             ldi 0                   ;set R5 and R10 to zero
   0d1f   a5                plo R5
   0d20   b5                phi R5
                            
   0d21   aa                plo R10
   0d22   ba                phi R10
                        
   0d23                 GET_STRING_LEN
   0d23   04                ldn R4                  
   0d24   ff 30             smi 48
   0d26   3b 47             bm GET_STRING_LEN_END   ;if *R4 < '0'
   0d28   04                ldn R4
   0d29   ff 3a             smi 58
   0d2b   3b 43             bm GET_STRING_ADDLEN    ;if *R4 <= '9'
   0d2d   04                ldn R4
   0d2e   ff 41             smi 65
   0d30   3b 47             bm GET_STRING_LEN_END   ;if *R4 < 'A'
   0d32   04                ldn R4
   0d33   ff 5b             smi 91
   0d35   3b 43             bm GET_STRING_ADDLEN    ;if *R4 <= 'Z'
   0d37   04                ldn R4
   0d38   ff 61             smi 97
   0d3a   3b 47             bm GET_STRING_LEN_END   ;if *R4 < 'a'
   0d3c   04                ldn R4
   0d3d   ff 7b             smi 123
   0d3f   3b 43             bm GET_STRING_ADDLEN    ;if *R4 <= 'z'
                            
   0d41   30 47             br GET_STRING_LEN_END   ;length checking end
                            
   0d43                 GET_STRING_ADDLEN
   0d43   15                inc R5                  ;increment R4 and R5
   0d44   14                inc R4
   0d45   30 23             br GET_STRING_LEN
                                
   0d47                 GET_STRING_LEN_END
   0d47   85                glo R5
   0d48   3a 4d             bnz GET_STRING_ALLOCATE_MEM
   0d4a   95                ghi R5
   0d4b   32 79             bz GET_STRING_END               ;if R5 == 0
                            
   0d4d                 GET_STRING_ALLOCATE_MEM
   0d4d   85                glo R5
   0d4e   a4                plo R4
   0d4f   95                ghi R5
   0d50   b4                phi R4
   0d51   14                inc R4                          ;increment R4 because we need spacefor the termination char
                            
   0d52   f8 e7             ldi DYN_MEMORY_ALLOC.0         ;call DYN_MEMORY_ALLOC
   0d54   ad                plo CALL_REG
   0d55   f8 0a             ldi DYN_MEMORY_ALLOC.1
   0d57   bd                phi CALL_REG
                            
   0d58   f8 00             ldi FCALL.0
   0d5a   ae                plo FCALL_REG
   0d5b   de                sep FCALL_REG
                            
   0d5c   8a                glo R10
   0d5d   3a 62             bnz GET_STRING_COPY
   0d5f   9a                ghi R10
   0d60   32 79             bz GET_STRING_END               ;if R10 == 0
                            
   0d62                 GET_STRING_COPY
   0d62   8f                glo STACK_REG                   ;restore R4
   0d63   a6                plo R6
   0d64   9f                ghi STACK_REG
   0d65   b6                phi R6
   0d66   16                inc R6
                            
   0d67   46                lda R6
   0d68   a4                plo R4
   0d69   46                lda R6
   0d6a   b4                phi R4
                            
   0d6b   8a                glo R10                         ;R6 = R10
   0d6c   a6                plo R6
   0d6d   9a                ghi R10
   0d6e   b6                phi R6
                            
   0d6f                 GET_STRING_COPY_LOOP
   0d6f   44                lda R4                          ;read data from R4 location
   0d70   56                str R6                          ;and store to R6 location
   0d71   16                inc R6
                            
   0d72   25                dec R5                          ;decrement R5
   0d73   85                glo R5
   0d74   3a 6f             bnz GET_STRING_COPY_LOOP        ;if R5 != 0
                            
   0d76   f8 00             ldi 0
   0d78   56                str R6                          ;terminate the string
                        
   0d79                 GET_STRING_END
   0d79   60                irx
   0d7a   60                irx
   0d7b   60                irx
                            
   0d7c   72                ldxa                            ;restore local registers
   0d7d   a6                plo R6
   0d7e   72                ldxa
   0d7f   b6                phi R6
                            
   0d80   72                ldxa
   0d81   a5                plo R5
   0d82   f0                ldx
   0d83   b5                phi R5
                            
   0d84   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-LET-STATEMENT--------------------------------
                        ;-R4-Input string------------------------------
                        ;-Local registres------------------------------
                        ;-R5-R6-R7-------------------------------------
   0d85                 LET_STATEMENT
   0d85   ef                sex STACK_REG
                            
   0d86   95                ghi R5
   0d87   73                stxd
   0d88   85                glo R5
   0d89   73                stxd
                            
   0d8a   96                ghi R6
   0d8b   73                stxd
   0d8c   86                glo R6
   0d8d   73                stxd
                            
   0d8e   97                ghi R7
   0d8f   73                stxd
   0d90   87                glo R7
   0d91   73                stxd
                            
   0d92   94                ghi R4          ;saving R4 value
   0d93   73                stxd
   0d94   84                glo R4
   0d95   73                stxd            ;+3 inputString
                            
   0d96   f8 00             ldi 0
   0d98   73                stxd
   0d99   73                stxd            ;+1 variableNode address
                            
   0d9a   b4                phi R4          ;R4 = 8
   0d9b   f8 08             ldi 8
   0d9d   a4                plo R4
                            
   0d9e   f8 e7             ldi DYN_MEMORY_ALLOC.0          ;call DYN_MEMORY_ALLOC
   0da0   ad                plo CALL_REG                    ;Allocating memory for the variable node
   0da1   f8 0a             ldi DYN_MEMORY_ALLOC.1
   0da3   bd                phi CALL_REG
                            
   0da4   f8 00             ldi FCALL.0
   0da6   ae                plo FCALL_REG
   0da7   de                sep FCALL_REG
                            
   0da8   8a                glo R10
   0da9   3a af             bnz LET_STATEMENT_CONTINUE1
   0dab   9a                ghi R10
   0dac   c2 0e 5f          lbz LET_STATEMENT_END            ;if R10 == 0
                            
   0daf                 LET_STATEMENT_CONTINUE1
   0daf   8f                glo STACK_REG                   ;set R5 pointer to variableNode address
   0db0   a5                plo R5
   0db1   9f                ghi STACK_REG
   0db2   b5                phi R5
   0db3   15                inc R5
                            
   0db4   8a                glo R10                         ;store R10 to variableNode address
   0db5   55                str R5
   0db6   15                inc R5
                            
   0db7   9a                ghi R10
   0db8   55                str R5
   0db9   15                inc R5
                        
   0dba   45                lda R5                          ;restore R4 inputString
   0dbb   a4                plo R4
   0dbc   45                lda R5
   0dbd   b4                phi R4
                            
   0dbe                 LET_STATEMENT_SKIPSPACES            ;skipping spaces
   0dbe   44                lda R4
   0dbf   fb 20             xri 32
   0dc1   32 be             bz LET_STATEMENT_SKIPSPACES
                            
   0dc3   24                dec R4
                            
   0dc4   f8 10             ldi GET_STRING.0                ;call GET_STRING
   0dc6   ad                plo CALL_REG
   0dc7   f8 0d             ldi GET_STRING.1
   0dc9   bd                phi CALL_REG
                            
   0dca   f8 00             ldi FCALL.0
   0dcc   ae                plo FCALL_REG
   0dcd   de                sep FCALL_REG
                            
   0dce   8a                glo R10
   0dcf   3a d5             bnz LET_STATEMENT_CONTINUE2
   0dd1   9a                ghi R10
   0dd2   c2 0e 4f          lbz LET_STATEMENT_FREENODE       ;if allocating failed
                        
   0dd5                 LET_STATEMENT_CONTINUE2
   0dd5   8f                glo STACK_REG
   0dd6   a6                plo R6
   0dd7   9f                ghi STACK_REG
   0dd8   b6                phi R6
   0dd9   16                inc R6
                            
   0dda   46                lda R6                          ;set R6 to variableNode address
   0ddb   a5                plo R5
   0ddc   46                lda R6
   0ddd   b5                phi R5
                            
   0dde   f8 00             ldi 0                           ;set variableNode->nextNode to 0
   0de0   55                str R5
   0de1   15                inc R5
                            
   0de2   55                str R5
   0de3   15                inc R5
                            
   0de4   8a                glo R10                         ;store R10 to variableNode->name
   0de5   55                str R5
   0de6   15                inc R5
                            
   0de7   9a                ghi R10
   0de8   55                str R5
   0de9   15                inc R5
                            
   0dea                 LET_STATEMENT_MAINLOOP
   0dea   04                ldn R4
   0deb   fb 20             xri 32
   0ded   32 f7             bz LET_STATEMENT_NEXTCHARACTER      ;if ' '
   0def   04                ldn R4
   0df0   fb 3d             xri 61
   0df2   32 fa             bz LET_STATEMENT_EXPRESSION         ;if '='
                            
   0df4   c0 0e 5f          lbr LET_STATEMENT_END
                        
   0df7                 LET_STATEMENT_NEXTCHARACTER
   0df7   14                inc R4
   0df8   30 ea             br LET_STATEMENT_MAINLOOP
                        
   0dfa                 LET_STATEMENT_EXPRESSION
   0dfa   14                inc R4
                            
   0dfb   f8 55             ldi EXPRESSION.0         ;call EXPRESSION
   0dfd   ad                plo CALL_REG
   0dfe   f8 08             ldi EXPRESSION.1
   0e00   bd                phi CALL_REG
                            
   0e01   f8 00             ldi FCALL.0
   0e03   ae                plo FCALL_REG
   0e04   de                sep FCALL_REG
                            
   0e05                 LET_STATEMENT_ADDVAR
   0e05   f8 00             ldi VARLIST_COUNT.0
   0e07   a5                plo R5
   0e08   f8 21             ldi VARLIST_COUNT.1
   0e0a   b5                phi R5
                            
   0e0b   e5                sex R5
                            
   0e0c   45                lda R5
   0e0d   ca 0e 14          lbnz LET_STATEMENT_ADDNODE
   0e10   05                ldn R5
   0e11   c2 0e 34          lbz LET_STATEMENT_FIRSTNODE
                            
   0e14                 LET_STATEMENT_ADDNODE
   0e14   25                dec R5                          ;reset R5 to the VARLIST header
                            
   0e15   f8 01             ldi 1                           ;increment the VARLIST_COUNT by one
   0e17   f4                add
   0e18   55                str R5
   0e19   15                inc R5
                            
   0e1a   f8 00             ldi 0
   0e1c   74                adc
   0e1d   55                str R5
   0e1e   15                inc R5
                            
   0e1f   15                inc R5                          ;skip VARLIST_FIRSTNODE
   0e20   15                inc R5
                            
   0e21   45                lda R5                          ;read VARLIST_LASTNODE
   0e22   a7                plo R7                          ;and place the address to R7
   0e23   05                ldn R5
   0e24   b7                phi R7
                            
   0e25   25                dec R5                          ;set R5 back to VARLIST_LASTNODE
                            
   0e26   26                dec R6                          ;reset R6 to variableNode
   0e27   26                dec R6
                            
   0e28   46                lda R6                          ;load address and store it to address R7 and R5
   0e29   57                str R7
   0e2a   55                str R5
   0e2b   17                inc R7
   0e2c   15                inc R5
                            
   0e2d   46                lda R6
   0e2e   57                str R7
   0e2f   55                str R5
   0e30   17                inc R7
   0e31   15                inc R5
                            
   0e32   30 5f             br LET_STATEMENT_END
                        
   0e34                 LET_STATEMENT_FIRSTNODE
   0e34   25                dec R5                          ;reset R5 to the VARLIST header
                            
   0e35   f8 01             ldi 1                           ;set VARLIST_COUNT to one
   0e37   55                str R5
   0e38   15                inc R5
                            
   0e39   f8 00             ldi 0
   0e3b   55                str R5
   0e3c   15                inc R5
                            
   0e3d   26                dec R6                          ;reset R6 to variableNode
   0e3e   26                dec R6
                            
   0e3f   46                lda R6                          ;load address and store it to VARLIST_FIRSTNODE
   0e40   55                str R5
   0e41   15                inc R5
                            
   0e42   46                lda R6
   0e43   55                str R5
   0e44   15                inc R5
                            
   0e45   26                dec R6                          ;reset R6 to variableNode
   0e46   26                dec R6
                            
   0e47   46                lda R6                          ;load address and store it to VARLIST_LASTNODE
   0e48   55                str R5
   0e49   15                inc R5
                            
   0e4a   46                lda R6
   0e4b   55                str R5
   0e4c   15                inc R5
                            
   0e4d   30 5f             br LET_STATEMENT_END
                        
   0e4f                 LET_STATEMENT_FREENODE
   0e4f   25                dec R5
   0e50   25                dec R5
                            
   0e51   45                lda R5
   0e52   a4                plo R4
   0e53   45                lda R5
   0e54   b4                phi R4
                            
   0e55   f8 4a             ldi DYN_MEMORY_FREE.0         ;call DYN_MEMORY_FREE
   0e57   ad                plo CALL_REG
   0e58   f8 0c             ldi DYN_MEMORY_FREE.1
   0e5a   bd                phi CALL_REG
                            
   0e5b   f8 00             ldi FCALL.0
   0e5d   ae                plo FCALL_REG
   0e5e   de                sep FCALL_REG
                            
   0e5f                 LET_STATEMENT_END
   0e5f   8f                glo STACK_REG
   0e60   fc 05             adi 5
   0e62   af                plo STACK_REG
   0e63   9f                ghi STACK_REG
   0e64   7c 00             adci 0
   0e66   bf                phi STACK_REG
                            
   0e67   ef                sex STACK_REG
                            
   0e68   72                ldxa
   0e69   a7                plo R7
   0e6a   72                ldxa
   0e6b   b7                phi R7
                            
   0e6c   72                ldxa
   0e6d   a6                plo R6
   0e6e   72                ldxa
   0e6f   b6                phi R6
                            
   0e70   72                ldxa
   0e71   a5                plo R5
   0e72   f0                ldx
   0e73   b5                phi R5
                            
   0e74   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-HEXVIEWER------------------------------------
                        ;-R4-Start address-----------------------------
                        ;-R5-Count-------------------------------------
   0e75                 HEX_BASE_SRT
   0e75   0d 0a 42 61       db "\r\nBase address: 0x",0
   0e79   73 65 20 61   
   0e7d   64 64 72 65   
   0e81   73 73 3a 20   
   0e85   30 78 00      
   0e88                 HEX_HEADER_STR
   0e88   0d 0a 0d 0a       db "\r\n\r\nOffset  00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F  String\r\n"
   0e8c   4f 66 66 73   
   0e90   65 74 20 20   
   0e94   30 30 20 30   
   0e98   31 20 30 32   
   0e9c   20 30 33 20   
   0ea0   30 34 20 30   
   0ea4   35 20 30 36   
   0ea8   20 30 37 20   
   0eac   30 38 20 30   
   0eb0   39 20 30 41   
   0eb4   20 30 42 20   
   0eb8   30 43 20 30   
   0ebc   44 20 30 45   
   0ec0   20 30 46 20   
   0ec4   20 53 74 72   
   0ec8   69 6e 67 0d   
   0ecc   0a            
   0ecd   2d 2d 2d 2d       db         "-------------------------------------------------------------------------\r\n",0
   0ed1   2d 2d 2d 2d   
   0ed5   2d 2d 2d 2d   
   0ed9   2d 2d 2d 2d   
   0edd   2d 2d 2d 2d   
   0ee1   2d 2d 2d 2d   
   0ee5   2d 2d 2d 2d   
   0ee9   2d 2d 2d 2d   
   0eed   2d 2d 2d 2d   
   0ef1   2d 2d 2d 2d   
   0ef5   2d 2d 2d 2d   
   0ef9   2d 2d 2d 2d   
   0efd   2d 2d 2d 2d   
   0f01   2d 2d 2d 2d   
   0f05   2d 2d 2d 2d   
   0f09   2d 2d 2d 2d   
   0f0d   2d 2d 2d 2d   
   0f11   2d 2d 2d 2d   
   0f15   2d 0d 0a 00   
                        ;              "0000:   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................"
   0f19                 HEX_LINECNT_SEPARATOR
   0f19   3a 20 20 20       db ":   ",0
   0f1d   00            
                            
   0f1e                 HEXVIEWER
   0f1e   ef                sex STACK_REG
                            
   0f1f   f8 00             ldi 0
   0f21   73                stxd
   0f22   73                stxd
   0f23   94                ghi R4
   0f24   73                stxd
   0f25   84                glo R4
   0f26   73                stxd    ;+17 current address
                            
   0f27   f8 00             ldi 0
   0f29   73                stxd
   0f2a   73                stxd
   0f2b   94                ghi R4
   0f2c   73                stxd
   0f2d   84                glo R4
   0f2e   73                stxd    ;+13 start address
                            
   0f2f   f8 00             ldi 0
   0f31   73                stxd
   0f32   73                stxd
   0f33   95                ghi R5
   0f34   73                stxd
   0f35   85                glo R5
   0f36   73                stxd    ;+9 last address
                            
   0f37   f8 00             ldi 0
   0f39   73                stxd
   0f3a   73                stxd
   0f3b   73                stxd
   0f3c   73                stxd    ;+5 line counter
                            
   0f3d   73                stxd
   0f3e   73                stxd
   0f3f   73                stxd
   0f40   73                stxd    ;+1 temp for hex digits
                            
   0f41   8f                glo STACK_REG
   0f42   fc 0d             adi 13
   0f44   a4                plo R4
   0f45   9f                ghi STACK_REG
   0f46   7c 00             adci 0
   0f48   b4                phi R4
                            
   0f49   8f                glo STACK_REG
   0f4a   fc 09             adi 9
   0f4c   a6                plo R6
   0f4d   9f                ghi STACK_REG
   0f4e   7c 00             adci 0
   0f50   b6                phi R6
                            
   0f51   e4                sex R4
                            
   0f52   85                glo R5      ;adding R5 value to start address and store it to last address
   0f53   f4                add
   0f54   56                str R6
   0f55   60                irx
   0f56   16                inc R6
   0f57   95                ghi R5
   0f58   74                adc
   0f59   56                str R6
   0f5a   60                irx
   0f5b   16                inc R6
   0f5c   f8 00             ldi 0
   0f5e   74                adc
   0f5f   56                str R6
                            
   0f60   f8 75             ldi HEX_BASE_SRT.0     ;prepare to print base address
   0f62   a6                plo R6
   0f63   f8 0e             ldi HEX_BASE_SRT.1
   0f65   b6                phi R6
                        	
   0f66   f8 52             ldi PRINT.0         ;prepare to call PRINT
   0f68   ad                plo CALL_REG
   0f69   f8 01             ldi PRINT.1
   0f6b   bd                phi CALL_REG
                            
   0f6c   f8 00             ldi FCALL.0
   0f6e   ae                plo FCALL_REG
   0f6f   de                sep FCALL_REG
                            
   0f70   8f                glo STACK_REG       ;prepare to print the address in hex
   0f71   fc 0d             adi 13
   0f73   a4                plo R4
   0f74   9f                ghi STACK_REG
   0f75   7c 00             adci 0
   0f77   b4                phi R4
                            
   0f78   f8 04             ldi 4               ;with 4 digits
   0f7a   a5                plo R5
                            
   0f7b   f8 22             ldi PRINT_HEX.0     ;prepare to call PRINT_HEX
   0f7d   ad                plo CALL_REG
   0f7e   f8 04             ldi PRINT_HEX.1
   0f80   bd                phi CALL_REG
                            
   0f81   f8 00             ldi FCALL.0
   0f83   ae                plo FCALL_REG
   0f84   de                sep FCALL_REG
                            
   0f85   f8 88             ldi HEX_HEADER_STR.0     ;prepare to print the header
   0f87   a6                plo R6
   0f88   f8 0e             ldi HEX_HEADER_STR.1
   0f8a   b6                phi R6
                        	
   0f8b   f8 52             ldi PRINT.0         ;prepare to call PRINT
   0f8d   ad                plo CALL_REG
   0f8e   f8 01             ldi PRINT.1
   0f90   bd                phi CALL_REG
                            
   0f91   f8 00             ldi FCALL.0
   0f93   ae                plo FCALL_REG
   0f94   de                sep FCALL_REG
                        
   0f95                 HEXVIEWER_MAINLOOP
   0f95   8f                glo STACK_REG       ;prepare to print the first address in hex
   0f96   fc 05             adi 5
   0f98   a4                plo R4
   0f99   9f                ghi STACK_REG
   0f9a   7c 00             adci 0
   0f9c   b4                phi R4
                            
   0f9d   f8 04             ldi 4               ;with 4 digits
   0f9f   a5                plo R5
                            
   0fa0   f8 22             ldi PRINT_HEX.0     ;prepare to call PRINT_HEX
   0fa2   ad                plo CALL_REG
   0fa3   f8 04             ldi PRINT_HEX.1
   0fa5   bd                phi CALL_REG
                            
   0fa6   f8 00             ldi FCALL.0
   0fa8   ae                plo FCALL_REG
   0fa9   de                sep FCALL_REG
                            
   0faa   f8 19             ldi HEX_LINECNT_SEPARATOR.0     ;prepare to print address separator
   0fac   a6                plo R6
   0fad   f8 0f             ldi HEX_LINECNT_SEPARATOR.1
   0faf   b6                phi R6
                        	
   0fb0   f8 52             ldi PRINT.0         ;prepare to call PRINT
   0fb2   ad                plo CALL_REG
   0fb3   f8 01             ldi PRINT.1
   0fb5   bd                phi CALL_REG
                            
   0fb6   f8 00             ldi FCALL.0
   0fb8   ae                plo FCALL_REG
   0fb9   de                sep FCALL_REG
                            
   0fba   f8 10             ldi 16      ;set R8 low to 16 for counting the bytes
   0fbc   a8                plo R8
                           
   0fbd                 HEXVIEWER_PRINT_HEX_LOOP
   0fbd   8f                glo STACK_REG       ;set R4 pointer to current address
   0fbe   fc 11             adi 17
   0fc0   a4                plo R4
   0fc1   9f                ghi STACK_REG
   0fc2   7c 00             adci 0
   0fc4   b4                phi R4
                            
   0fc5   8f                glo STACK_REG       ;set R5 pointer to last address
   0fc6   fc 09             adi 9
   0fc8   a5                plo R5
   0fc9   9f                ghi STACK_REG
   0fca   7c 00             adci 0
   0fcc   b5                phi R5
                        
   0fcd   e4                sex R4          ;check if current address is >= last address
                            
   0fce   45                lda R5
   0fcf   f5                sd
   0fd0   60                irx
                            
   0fd1   45                lda R5
   0fd2   75                sdb
   0fd3   60                irx
                            
   0fd4   45                lda R5
   0fd5   75                sdb
   0fd6   60                irx
                            
   0fd7   05                ldn R5
   0fd8   75                sdb
                            
   0fd9   c3 10 01          lbdf HEXVIEWER_PRINT_HEX_SPACES   ;if current address >= last address then 
                        
   0fdc   8f                glo STACK_REG       ;set R4 pointer to current address
   0fdd   fc 11             adi 17
   0fdf   a4                plo R4
   0fe0   9f                ghi STACK_REG
   0fe1   7c 00             adci 0
   0fe3   b4                phi R4
                            
   0fe4   44                lda R4              ;get current address and load it in R5
   0fe5   a5                plo R5
   0fe6   44                lda R4
   0fe7   b5                phi R5
                            
   0fe8   05                ldn R5              ;get data from R5 address
   0fe9   a5                plo R5              ;store data in R5 low
                            
   0fea   8f                glo STACK_REG       ;set R4 pointer to temp
   0feb   a4                plo R4
   0fec   9f                ghi STACK_REG
   0fed   b4                phi R4
   0fee   14                inc R4
                            
   0fef   85                glo R5              ;get data from R5 low
   0ff0   54                str R4              ;store data to temp
                           
   0ff1   f8 02             ldi 2
   0ff3   a5                plo R5              ;set R5 low to 2 digits
                            
   0ff4   f8 22             ldi PRINT_HEX.0     ;prepare to call PRINT_HEX
   0ff6   ad                plo CALL_REG
   0ff7   f8 04             ldi PRINT_HEX.1
   0ff9   bd                phi CALL_REG
                            
   0ffa   f8 00             ldi FCALL.0
   0ffc   ae                plo FCALL_REG
   0ffd   de                sep FCALL_REG
                            
   0ffe   c0 10 11          lbr HEXVIEWER_NEXT_HEX
                            
   1001                 HEXVIEWER_PRINT_HEX_SPACES
   1001   f8 1b             ldi HEX_LINECNT_SEPARATOR+2.0     ;prepare to print two space
   1003   a6                plo R6
   1004   f8 0f             ldi HEX_LINECNT_SEPARATOR+2.1
   1006   b6                phi R6
                        	
   1007   f8 52             ldi PRINT.0         ;prepare to call PRINT
   1009   ad                plo CALL_REG
   100a   f8 01             ldi PRINT.1
   100c   bd                phi CALL_REG
                            
   100d   f8 00             ldi FCALL.0
   100f   ae                plo FCALL_REG
   1010   de                sep FCALL_REG
                        
   1011                 HEXVIEWER_NEXT_HEX
   1011   f8 1c             ldi HEX_LINECNT_SEPARATOR+3.0     ;prepare to print a space
   1013   a6                plo R6
   1014   f8 0f             ldi HEX_LINECNT_SEPARATOR+3.1
   1016   b6                phi R6
                        	
   1017   f8 52             ldi PRINT.0         ;prepare to call PRINT
   1019   ad                plo CALL_REG
   101a   f8 01             ldi PRINT.1
   101c   bd                phi CALL_REG
                            
   101d   f8 00             ldi FCALL.0
   101f   ae                plo FCALL_REG
   1020   de                sep FCALL_REG
                            
   1021   8f                glo STACK_REG       ;set R4 pointer to current address
   1022   fc 11             adi 17
   1024   a4                plo R4
   1025   9f                ghi STACK_REG
   1026   7c 00             adci 0
   1028   b4                phi R4
                            
   1029   e4                sex R4
   102a   f8 01             ldi 1
   102c   f4                add
   102d   54                str R4
   102e   60                irx
                            
   102f   f8 00             ldi 0
   1031   74                adc
   1032   54                str R4
   1033   60                irx
                            
   1034   f8 00             ldi 0
   1036   74                adc
   1037   54                str R4
   1038   60                irx
                            
   1039   f8 00             ldi 0
   103b   74                adc
   103c   54                str R4
                            
   103d   28                dec R8
   103e   88                glo R8
   103f   ca 0f bd          lbnz HEXVIEWER_PRINT_HEX_LOOP
                            
   1042   f8 1c             ldi HEX_LINECNT_SEPARATOR+3.0     ;prepare to print a space
   1044   a6                plo R6
   1045   f8 0f             ldi HEX_LINECNT_SEPARATOR+3.1
   1047   b6                phi R6
                        	
   1048   f8 52             ldi PRINT.0         ;prepare to call PRINT
   104a   ad                plo CALL_REG
   104b   f8 01             ldi PRINT.1
   104d   bd                phi CALL_REG
                            
   104e   f8 00             ldi FCALL.0
   1050   ae                plo FCALL_REG
   1051   de                sep FCALL_REG
                            
   1052   8f                glo STACK_REG       ;set R4 pointer to current address
   1053   fc 11             adi 17
   1055   a4                plo R4
   1056   9f                ghi STACK_REG
   1057   7c 00             adci 0
   1059   b4                phi R4
                            
   105a   8f                glo STACK_REG       ;set R5 pointer to start address
   105b   fc 0d             adi 13
   105d   a5                plo R5
   105e   9f                ghi STACK_REG
   105f   7c 00             adci 0
   1061   b5                phi R5
                            
   1062   e5                sex R5
                            
   1063   72                ldxa
   1064   54                str R4
   1065   14                inc R4
                            
   1066   72                ldxa
   1067   54                str R4
   1068   14                inc R4
                            
   1069   72                ldxa
   106a   54                str R4
   106b   14                inc R4
                            
   106c   72                ldxa
   106d   54                str R4
                            
   106e   f8 10             ldi 16      ;set R8 low to 16 for counting the bytes
   1070   a8                plo R8
                        
   1071                 HEXVIEWER_PRINT_STR_LOOP
   1071   8f                glo STACK_REG       ;set R4 pointer to current address
   1072   fc 11             adi 17
   1074   a4                plo R4
   1075   9f                ghi STACK_REG
   1076   7c 00             adci 0
   1078   b4                phi R4
                            
   1079   8f                glo STACK_REG       ;set R5 pointer to last address
   107a   fc 09             adi 9
   107c   a5                plo R5
   107d   9f                ghi STACK_REG
   107e   7c 00             adci 0
   1080   b5                phi R5
                        
   1081   e4                sex R4          ;check if current address is <= last address
                            
   1082   45                lda R5
   1083   f5                sd
   1084   60                irx
                            
   1085   45                lda R5
   1086   75                sdb
   1087   60                irx
                            
   1088   45                lda R5
   1089   75                sdb
   108a   60                irx
                            
   108b   05                ldn R5
   108c   75                sdb
                            
   108d   c3 10 c3          lbdf HEXVIEWER_PRINT_STR_SPACE   ;if current address >= last address then 
                            
   1090   8f                glo STACK_REG       ;set R4 pointer to current address
   1091   fc 11             adi 17
   1093   a4                plo R4
   1094   9f                ghi STACK_REG
   1095   7c 00             adci 0
   1097   b4                phi R4
                            
   1098   44                lda R4              ;get current address and load it in R5
   1099   a5                plo R5
   109a   44                lda R4
   109b   b5                phi R5
                            
   109c   05                ldn R5              ;get data from R5 address
   109d   a5                plo R5              ;store data in R5 low
                            
   109e   ff 20             smi 32
   10a0   3b b4             bm HEXVIEWER_PRINT_STR_DOT
   10a2   ff 5f             smi 95
   10a4   33 b4             bpz HEXVIEWER_PRINT_STR_DOT
                            
   10a6   85                glo R5
   10a7   b4                phi R4
                            
   10a8   f8 13             ldi SERIAL_SEND_START.0         ;prepare to call SERIAL_SEND_START to send one char
   10aa   ad                plo CALL_REG
   10ab   f8 01             ldi SERIAL_SEND_START.1
   10ad   bd                phi CALL_REG
                            
   10ae   f8 00             ldi FCALL.0
   10b0   ae                plo FCALL_REG
   10b1   de                sep FCALL_REG
                            
   10b2   30 d0             br HEXVIEWER_NEXT_STR
                            
   10b4                 HEXVIEWER_PRINT_STR_DOT
   10b4   f8 2e             ldi 46
   10b6   b4                phi R4
                            
   10b7   f8 13             ldi SERIAL_SEND_START.0         ;prepare to call SERIAL_SEND_START to send one char
   10b9   ad                plo CALL_REG
   10ba   f8 01             ldi SERIAL_SEND_START.1
   10bc   bd                phi CALL_REG
                            
   10bd   f8 00             ldi FCALL.0
   10bf   ae                plo FCALL_REG
   10c0   de                sep FCALL_REG
                            
   10c1   30 d0             br HEXVIEWER_NEXT_STR
                        
   10c3                 HEXVIEWER_PRINT_STR_SPACE
   10c3   f8 20             ldi 32
   10c5   b4                phi R4
                            
   10c6   f8 13             ldi SERIAL_SEND_START.0         ;prepare to call SERIAL_SEND_START to send one char
   10c8   ad                plo CALL_REG
   10c9   f8 01             ldi SERIAL_SEND_START.1
   10cb   bd                phi CALL_REG
                            
   10cc   f8 00             ldi FCALL.0
   10ce   ae                plo FCALL_REG
   10cf   de                sep FCALL_REG
                            
   10d0                 HEXVIEWER_NEXT_STR
   10d0   8f                glo STACK_REG       ;set R4 pointer to current address
   10d1   fc 11             adi 17
   10d3   a4                plo R4
   10d4   9f                ghi STACK_REG
   10d5   7c 00             adci 0
   10d7   b4                phi R4
                            
   10d8   e4                sex R4
   10d9   f8 01             ldi 1
   10db   f4                add
   10dc   54                str R4
   10dd   60                irx
                            
   10de   f8 00             ldi 0
   10e0   74                adc
   10e1   54                str R4
   10e2   60                irx
                            
   10e3   f8 00             ldi 0
   10e5   74                adc
   10e6   54                str R4
   10e7   60                irx
                            
   10e8   f8 00             ldi 0
   10ea   74                adc
   10eb   54                str R4
                            
   10ec   28                dec R8
   10ed   88                glo R8
   10ee   ca 10 71          lbnz HEXVIEWER_PRINT_STR_LOOP
                            
   10f1   f8 01             ldi NEW_LINE.0     ;prepare to print a space
   10f3   a6                plo R6
   10f4   f8 15             ldi NEW_LINE.1
   10f6   b6                phi R6
                        	
   10f7   f8 52             ldi PRINT.0         ;prepare to call PRINT
   10f9   ad                plo CALL_REG
   10fa   f8 01             ldi PRINT.1
   10fc   bd                phi CALL_REG
                            
   10fd   f8 00             ldi FCALL.0
   10ff   ae                plo FCALL_REG
   1100   de                sep FCALL_REG
                            
   1101   8f                glo STACK_REG       ;set R4 pointer to current address
   1102   fc 11             adi 17
   1104   a4                plo R4
   1105   9f                ghi STACK_REG
   1106   7c 00             adci 0
   1108   b4                phi R4
                            
   1109   8f                glo STACK_REG       ;set R5 pointer to last address
   110a   fc 09             adi 9
   110c   a5                plo R5
   110d   9f                ghi STACK_REG
   110e   7c 00             adci 0
   1110   b5                phi R5
                        
   1111   e4                sex R4          ;check if current address is >= last address
                            
   1112   45                lda R5
   1113   f5                sd
   1114   60                irx
                            
   1115   45                lda R5
   1116   75                sdb
   1117   60                irx
                            
   1118   45                lda R5
   1119   75                sdb
   111a   60                irx
                            
   111b   05                ldn R5
   111c   75                sdb
                            
   111d   c3 11 5b          lbdf HEXVIEWER_END
                            
   1120   8f                glo STACK_REG       ;set R4 pointer to line counter
   1121   fc 05             adi 5
   1123   a4                plo R4
   1124   9f                ghi STACK_REG
   1125   7c 00             adci 0
   1127   b4                phi R4
                            
   1128   e4                sex R4
                            
   1129   f8 10             ldi 16
   112b   f4                add
   112c   54                str R4
   112d   60                irx
                            
   112e   f8 00             ldi 0
   1130   74                adc
   1131   54                str R4
   1132   60                irx
                            
   1133   f8 00             ldi 0
   1135   74                adc
   1136   54                str R4
   1137   60                irx
                            
   1138   f8 00             ldi 0
   113a   74                adc
   113b   54                str R4
                            
   113c   8f                glo STACK_REG       ;set R4 pointer to current address
   113d   fc 11             adi 17
   113f   a4                plo R4
   1140   9f                ghi STACK_REG
   1141   7c 00             adci 0
   1143   b4                phi R4
                            
   1144   8f                glo STACK_REG       ;set R5 pointer to start address
   1145   fc 0d             adi 13
   1147   a5                plo R5
   1148   9f                ghi STACK_REG
   1149   7c 00             adci 0
   114b   b5                phi R5
                            
   114c   e4                sex R4
                            
   114d   72                ldxa
   114e   55                str R5
   114f   15                inc R5
                            
   1150   72                ldxa
   1151   55                str R5
   1152   15                inc R5
                            
   1153   72                ldxa
   1154   55                str R5
   1155   15                inc R5
                            
   1156   72                ldxa
   1157   55                str R5
                            
   1158   c0 0f 95          lbr HEXVIEWER_MAINLOOP
                        
   115b                 HEXVIEWER_END
   115b   8f                glo STACK_REG
   115c   fc 14             adi 20
   115e   af                plo STACK_REG
   115f   9f                ghi STACK_REG
   1160   7c 00             adci 0
   1162   bf                phi STACK_REG
                            
   1163   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-DYN MEMORY ALLOC CALLER----------------------
   1164                 DYN_MEMORY_ALLOC_CALLER_STR1
   1164   20 62 79 74       db " bytes of memory allocated at memory address ",0," (0x",0,")\r\n",0
   1168   65 73 20 6f   
   116c   66 20 6d 65   
   1170   6d 6f 72 79   
   1174   20 61 6c 6c   
   1178   6f 63 61 74   
   117c   65 64 20 61   
   1180   74 20 6d 65   
   1184   6d 6f 72 79   
   1188   20 61 64 64   
   118c   72 65 73 73   
   1190   20 00 20 28   
   1194   30 78 00 29   
   1198   0d 0a 00      
   119b                 DYN_MEMORY_ALLOC_CALLER_STR2
   119b   4f 75 74 20       db "Out of memory!\r\n",0
   119f   6f 66 20 6d   
   11a3   65 6d 6f 72   
   11a7   79 21 0d 0a   
   11ab   00            
                        
   11ac                 DYN_MEMORY_ALLOC_CALLER
   11ac   ef                sex STACK_REG
                            
   11ad   f8 00             ldi 0
   11af   73                stxd
   11b0   73                stxd
   11b1   73                stxd
   11b2   73                stxd                        ;+5 address
                            
   11b3   73                stxd
   11b4   73                stxd
   11b5   73                stxd
   11b6   73                stxd                        ;+1 size
                            
   11b7   8f                glo STACK_REG               ;set R5 pointer to size
   11b8   a5                plo R5
   11b9   9f                ghi STACK_REG
   11ba   b5                phi R5
   11bb   15                inc R5
                            
   11bc   f8 55             ldi EXPRESSION.0            ;evaluate expression
   11be   ad                plo CALL_REG
   11bf   f8 08             ldi EXPRESSION.1
   11c1   bd                phi CALL_REG
                            
   11c2   f8 00             ldi FCALL.0
   11c4   ae                plo FCALL_REG
   11c5   de                sep FCALL_REG
                            
   11c6   8f                glo STACK_REG               ;set R5 pointer to size
   11c7   a5                plo R5
   11c8   9f                ghi STACK_REG
   11c9   b5                phi R5
   11ca   15                inc R5
                            
   11cb   45                lda R5                      ;R4 = size
   11cc   a4                plo R4
   11cd   45                lda R5
   11ce   b4                phi R4
                            
   11cf   f8 e7             ldi DYN_MEMORY_ALLOC.0      ;call memory allocation
   11d1   ad                plo CALL_REG
   11d2   f8 0a             ldi DYN_MEMORY_ALLOC.1
   11d4   bd                phi CALL_REG
                            
   11d5   f8 00             ldi FCALL.0
   11d7   ae                plo FCALL_REG
   11d8   de                sep FCALL_REG
                            
   11d9   8a                glo R10                                 ;check if R10 has a value, if it is 0 then it failed
   11da   ca 11 f4          lbnz DYN_MEMORY_ALLOC_CALLER_SUCCESS
   11dd   9a                ghi R10
   11de   ca 11 f4          lbnz DYN_MEMORY_ALLOC_CALLER_SUCCESS
                            
   11e1                 DYN_MEMORY_ALLOC_CALLER_FAIL
   11e1   f8 9b             ldi DYN_MEMORY_ALLOC_CALLER_STR2.0      ;print out of memory
   11e3   a6                plo R6
   11e4   f8 11             ldi DYN_MEMORY_ALLOC_CALLER_STR2.1
   11e6   b6                phi R6
                            
   11e7   f8 52             ldi PRINT.0                             ;prepare to call PRINT
   11e9   ad                plo CALL_REG
   11ea   f8 01             ldi PRINT.1
   11ec   bd                phi CALL_REG
                            
   11ed   f8 00             ldi FCALL.0
   11ef   ae                plo FCALL_REG
   11f0   de                sep FCALL_REG                           ;call PRINT
                        	
   11f1   c0 12 5e          lbr DYN_MEMORY_ALLOC_CALLER_END         ;return
                        
   11f4                 DYN_MEMORY_ALLOC_CALLER_SUCCESS
   11f4   8f                glo STACK_REG                           ;set R5 pointer to address
   11f5   fc 05             adi 5
   11f7   a4                plo R4
   11f8   9f                ghi STACK_REG
   11f9   7c 00             adci 0
   11fb   b4                phi R4
                            
   11fc   8a                glo R10                                 ;copy R10 value to address
   11fd   54                str R4
   11fe   14                inc R4
                            
   11ff   9a                ghi R10
   1200   54                str R4
                            
   1201   8f                glo STACK_REG                           ;set R4 pointor to size
   1202   a4                plo R4
   1203   9f                ghi STACK_REG
   1204   b4                phi R4
   1205   14                inc R4
                            
   1206   f8 ae             ldi PRINT_DEC.0                         ;print size in decimal
   1208   ad                plo CALL_REG
   1209   f8 04             ldi PRINT_DEC.1
   120b   bd                phi CALL_REG
                            
   120c   f8 00             ldi FCALL.0
   120e   ae                plo FCALL_REG
   120f   de                sep FCALL_REG
                            
   1210   f8 64             ldi DYN_MEMORY_ALLOC_CALLER_STR1.0      ;print the first part of the allocation message
   1212   a6                plo R6
   1213   f8 11             ldi DYN_MEMORY_ALLOC_CALLER_STR1.1
   1215   b6                phi R6
                            
   1216   f8 52             ldi PRINT.0                             ;prepare to call PRINT
   1218   ad                plo CALL_REG    
   1219   f8 01             ldi PRINT.1
   121b   bd                phi CALL_REG
                            
   121c   f8 00             ldi FCALL.0
   121e   ae                plo FCALL_REG
   121f   de                sep FCALL_REG                           ;call PRINT
                            
   1220   8f                glo STACK_REG                           ;set R4 pointer to address
   1221   fc 05             adi 5
   1223   a4                plo R4
   1224   9f                ghi STACK_REG
   1225   7c 00             adci 0
   1227   b4                phi R4
                            
   1228   f8 ae             ldi PRINT_DEC.0                         ;print address in decimal
   122a   ad                plo CALL_REG
   122b   f8 04             ldi PRINT_DEC.1
   122d   bd                phi CALL_REG
                            
   122e   f8 00             ldi FCALL.0
   1230   ae                plo FCALL_REG
   1231   de                sep FCALL_REG
                            
   1232   f8 52             ldi PRINT.0                             ;print the second part of the allocation message
   1234   ad                plo CALL_REG
   1235   f8 01             ldi PRINT.1
   1237   bd                phi CALL_REG
                            
   1238   f8 00             ldi FCALL.0
   123a   ae                plo FCALL_REG
   123b   de                sep FCALL_REG                           ;call PRINT
                            
   123c   8f                glo STACK_REG                           ;reset R4 pointer to address
   123d   fc 05             adi 5
   123f   a4                plo R4
   1240   9f                ghi STACK_REG
   1241   7c 00             adci 0
   1243   b4                phi R4
                            
   1244   f8 04             ldi 4                                   ;set number of digits to 4
   1246   a5                plo R5
   1247   f8 00             ldi 0
   1249   b5                phi R5
                            
   124a   f8 22             ldi PRINT_HEX.0                         ;print address in hexadecimal
   124c   ad                plo CALL_REG
   124d   f8 04             ldi PRINT_HEX.1
   124f   bd                phi CALL_REG
                            
   1250   f8 00             ldi FCALL.0
   1252   ae                plo FCALL_REG
   1253   de                sep FCALL_REG
                            
   1254   f8 52             ldi PRINT.0                             ;print the last part of the allocation message
   1256   ad                plo CALL_REG
   1257   f8 01             ldi PRINT.1
   1259   bd                phi CALL_REG
                            
   125a   f8 00             ldi FCALL.0
   125c   ae                plo FCALL_REG
   125d   de                sep FCALL_REG                           ;call PRINT
                        
   125e                 DYN_MEMORY_ALLOC_CALLER_END
   125e   8f                glo STACK_REG
   125f   fc 08             adi 8
   1261   af                plo STACK_REG
   1262   9f                ghi STACK_REG
   1263   7c 00             adci 0
   1265   bf                phi STACK_REG
                            
   1266   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-DYN MEMORY FREE CALLER-----------------------
   1267                 DYN_MEMORY_FREE_CALLER_STR1
   1267   41 6c 6c 6f       db "Allocated memory has been freed at address ",0," (0x",0,")\r\n",0
   126b   63 61 74 65   
   126f   64 20 6d 65   
   1273   6d 6f 72 79   
   1277   20 68 61 73   
   127b   20 62 65 65   
   127f   6e 20 66 72   
   1283   65 65 64 20   
   1287   61 74 20 61   
   128b   64 64 72 65   
   128f   73 73 20 00   
   1293   20 28 30 78   
   1297   00 29 0d 0a   
   129b   00            
   129c                 DYN_MEMORY_FREE_CALLER_STR2
   129c   4d 65 6d 6f       db "Memory address is out of the heap range!\r\n",0
   12a0   72 79 20 61   
   12a4   64 64 72 65   
   12a8   73 73 20 69   
   12ac   73 20 6f 75   
   12b0   74 20 6f 66   
   12b4   20 74 68 65   
   12b8   20 68 65 61   
   12bc   70 20 72 61   
   12c0   6e 67 65 21   
   12c4   0d 0a 00      
                            
   12c7                 DYN_MEMORY_FREE_CALLER
   12c7   ef                sex STACK_REG
                            
   12c8   f8 00             ldi 0
   12ca   73                stxd
   12cb   73                stxd
   12cc   73                stxd
   12cd   73                stxd                    ;+1 address
                            
   12ce   8f                glo STACK_REG
   12cf   a5                plo R5
   12d0   9f                ghi STACK_REG
   12d1   b5                phi R5
   12d2   15                inc R5
                            
   12d3   f8 55             ldi EXPRESSION.0
   12d5   ad                plo CALL_REG
   12d6   f8 08             ldi EXPRESSION.1
   12d8   bd                phi CALL_REG
                            
   12d9   f8 00             ldi FCALL.0
   12db   ae                plo FCALL_REG
   12dc   de                sep FCALL_REG
                            
   12dd   8f                glo STACK_REG
   12de   a5                plo R5
   12df   9f                ghi STACK_REG
   12e0   b5                phi R5
   12e1   15                inc R5
                            
   12e2   e5                sex R5
                            
   12e3   f8 10             ldi HEAP_START.0
   12e5   f5                sd
   12e6   60                irx
   12e7   f8 21             ldi HEAP_START.1
   12e9   75                sdb
                            
   12ea   25                dec R5
                            
   12eb   cb 13 50          lbnf DYN_MEMORY_FREE_CALLER_OUTOFRANGE
                            
   12ee   f8 00             ldi HEAP_END.0
   12f0   f5                sd
   12f1   60                irx
   12f2   f8 fc             ldi HEAP_END.1
   12f4   75                sdb
                            
   12f5   25                dec R5
                            
   12f6   c3 13 50          lbdf DYN_MEMORY_FREE_CALLER_OUTOFRANGE
                            
   12f9   72                ldxa
   12fa   a4                plo R4
   12fb   f0                ldx
   12fc   b4                phi R4
                            
   12fd   25                dec R5
                            
   12fe   f8 4a             ldi DYN_MEMORY_FREE.0                 ;call free
   1300   ad                plo CALL_REG
   1301   f8 0c             ldi DYN_MEMORY_FREE.1
   1303   bd                phi CALL_REG
                            
   1304   f8 00             ldi FCALL.0
   1306   ae                plo FCALL_REG
   1307   de                sep FCALL_REG
                            
   1308   f8 67             ldi DYN_MEMORY_FREE_CALLER_STR1.0
   130a   a6                plo R6
   130b   f8 12             ldi DYN_MEMORY_FREE_CALLER_STR1.1
   130d   b6                phi R6
                            
   130e   f8 52             ldi PRINT.0                             ;print the success message 1st part
   1310   ad                plo CALL_REG
   1311   f8 01             ldi PRINT.1
   1313   bd                phi CALL_REG
                            
   1314   f8 00             ldi FCALL.0
   1316   ae                plo FCALL_REG
   1317   de                sep FCALL_REG
                            
   1318   85                glo R5
   1319   a4                plo R4
   131a   95                ghi R5
   131b   b4                phi R4
                            
   131c   f8 ae             ldi PRINT_DEC.0                         ;print address in decimal
   131e   ad                plo CALL_REG
   131f   f8 04             ldi PRINT_DEC.1
   1321   bd                phi CALL_REG
                            
   1322   f8 00             ldi FCALL.0
   1324   ae                plo FCALL_REG
   1325   de                sep FCALL_REG
                            
   1326   f8 52             ldi PRINT.0                             ;print the success message 2nd part
   1328   ad                plo CALL_REG
   1329   f8 01             ldi PRINT.1
   132b   bd                phi CALL_REG
                            
   132c   f8 00             ldi FCALL.0
   132e   ae                plo FCALL_REG
   132f   de                sep FCALL_REG
                            
   1330   85                glo R5
   1331   a4                plo R4
   1332   95                ghi R5
   1333   b4                phi R4
                            
   1334   f8 04             ldi 4
   1336   a5                plo R5
   1337   f8 00             ldi 0
   1339   b5                phi R5
                            
   133a   f8 22             ldi PRINT_HEX.0                         ;print address in hexadecimal
   133c   ad                plo CALL_REG
   133d   f8 04             ldi PRINT_HEX.1
   133f   bd                phi CALL_REG
                            
   1340   f8 00             ldi FCALL.0
   1342   ae                plo FCALL_REG
   1343   de                sep FCALL_REG
                            
   1344   f8 52             ldi PRINT.0                             ;print the success message 2nd part
   1346   ad                plo CALL_REG
   1347   f8 01             ldi PRINT.1
   1349   bd                phi CALL_REG
                            
   134a   f8 00             ldi FCALL.0
   134c   ae                plo FCALL_REG
   134d   de                sep FCALL_REG
                            
   134e   30 60             br DYN_MEMORY_FREE_CALLER_END
                            
   1350                 DYN_MEMORY_FREE_CALLER_OUTOFRANGE
   1350   f8 9c             ldi DYN_MEMORY_FREE_CALLER_STR2.0
   1352   a6                plo R6
   1353   f8 12             ldi DYN_MEMORY_FREE_CALLER_STR2.1
   1355   b6                phi R6
                            
   1356   f8 52             ldi PRINT.0                             ;print the out of range message
   1358   ad                plo CALL_REG
   1359   f8 01             ldi PRINT.1
   135b   bd                phi CALL_REG
                            
   135c   f8 00             ldi FCALL.0
   135e   ae                plo FCALL_REG
   135f   de                sep FCALL_REG                           ;call PRINT
                            
   1360                 DYN_MEMORY_FREE_CALLER_END
   1360   8f                glo STACK_REG
   1361   fc 04             adi 4
   1363   af                plo STACK_REG
   1364   9f                ghi STACK_REG
   1365   7c 00             adci 0
   1367   bf                phi STACK_REG
                            
   1368   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-HEXVIEW_CALLER-------------------------------
   1369                 HEXVIEW_CALLER
   1369   ef                sex STACK_REG
                            
   136a   f8 00             ldi 0
   136c   73                stxd
   136d   73                stxd
   136e   73                stxd
   136f   73                stxd    ;+5 first arg
                            
   1370   73                stxd
   1371   73                stxd
   1372   f8 01             ldi 1
   1374   73                stxd
   1375   f8 00             ldi 0
   1377   73                stxd    ;+1 second arg
                            
   1378   8f                glo STACK_REG
   1379   fc 05             adi 5
   137b   a5                plo R5
   137c   9f                ghi STACK_REG
   137d   7c 00             adci 0
   137f   b5                phi R5
                            
   1380   f8 55             ldi EXPRESSION.0
   1382   ad                plo CALL_REG
   1383   f8 08             ldi EXPRESSION.1
   1385   bd                phi CALL_REG
                            
   1386   f8 00             ldi FCALL.0
   1388   ae                plo FCALL_REG
   1389   de                sep FCALL_REG
                            
   138a   44                lda R4
   138b   fb 2c             xri 44
   138d   c2 13 a4          lbz HEXVIEW_CALLER_NEXTARG
   1390   24                dec R4
   1391   44                lda R4
   1392   c2 13 b3          lbz HEXVIEW_CALLER_EXEC
   1395   24                dec R4
                            
   1396   04                ldn R4
   1397   b4                phi R4
                            
   1398   f8 13             ldi SERIAL_SEND_START.0
   139a   ad                plo CALL_REG
   139b   f8 01             ldi SERIAL_SEND_START.1
   139d   bd                phi CALL_REG
                            
   139e   f8 00             ldi FCALL.0
   13a0   ae                plo FCALL_REG
   13a1   de                sep FCALL_REG
                            
   13a2   30 d2             br HEXVIEW_CALLER_END
                            
   13a4                 HEXVIEW_CALLER_NEXTARG
   13a4   8f                glo STACK_REG
   13a5   a5                plo R5
   13a6   9f                ghi STACK_REG
   13a7   b5                phi R5
   13a8   15                inc R5
                            
   13a9   f8 55             ldi EXPRESSION.0
   13ab   ad                plo CALL_REG
   13ac   f8 08             ldi EXPRESSION.1
   13ae   bd                phi CALL_REG
                            
   13af   f8 00             ldi FCALL.0
   13b1   ae                plo FCALL_REG
   13b2   de                sep FCALL_REG
                            
   13b3                 HEXVIEW_CALLER_EXEC
   13b3   8f                glo STACK_REG
   13b4   fc 05             adi 5
   13b6   a5                plo R5
   13b7   9f                ghi STACK_REG
   13b8   7c 00             adci 0
   13ba   b5                phi R5
                            
   13bb   45                lda R5
   13bc   a4                plo R4
   13bd   45                lda R5
   13be   b4                phi R4
                            
   13bf   8f                glo STACK_REG
   13c0   a6                plo R6
   13c1   9f                ghi STACK_REG
   13c2   b6                phi R6
   13c3   16                inc R6
                            
   13c4   46                lda R6
   13c5   a5                plo R5
   13c6   46                lda R6
   13c7   b5                phi R5
                            
   13c8   f8 1e             ldi HEXVIEWER.0
   13ca   ad                plo CALL_REG
   13cb   f8 0f             ldi HEXVIEWER.1
   13cd   bd                phi CALL_REG
                            
   13ce   f8 00             ldi FCALL.0
   13d0   ae                plo FCALL_REG
   13d1   de                sep FCALL_REG
                            
   13d2                 HEXVIEW_CALLER_END
   13d2   8f                glo STACK_REG
   13d3   fc 08             adi 8
   13d5   af                plo STACK_REG
   13d6   9f                ghi STACK_REG
   13d7   7c 00             adci 0
   13d9   bf                phi STACK_REG
                            
   13da   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-TEST FUNCTION--------------------------------
   13db                 TEST_STR1
   13db   52 65 73 75       db "Result: ",0
   13df   6c 74 3a 20   
   13e3   00            
                        
   13e4                 FUNC_TEST
   13e4   ef                sex STACK_REG
                            
   13e5   f8 00             ldi 0
   13e7   73                stxd
   13e8   73                stxd
   13e9   73                stxd
   13ea   73                stxd    ;+1 result
                            
   13eb   8f                glo STACK_REG
   13ec   a5                plo R5
   13ed   9f                ghi STACK_REG
   13ee   b5                phi R5
   13ef   15                inc R5
                            
   13f0   f8 55             ldi EXPRESSION.0
   13f2   ad                plo CALL_REG
   13f3   f8 08             ldi EXPRESSION.1
   13f5   bd                phi CALL_REG
                            
   13f6   f8 00             ldi FCALL.0
   13f8   ae                plo FCALL_REG
   13f9   de                sep FCALL_REG
                            
   13fa   8f                glo STACK_REG
   13fb   a4                plo R4
   13fc   9f                ghi STACK_REG
   13fd   b4                phi R4
   13fe   14                inc R4
                        
   13ff   f8 00             ldi 0
   1401   a5                plo R5
                            
   1402   f8 ae             ldi PRINT_DEC.0     ;prepare to print the Decimal result.
   1404   ad                plo CALL_REG
   1405   f8 04             ldi PRINT_DEC.1
   1407   bd                phi CALL_REG
                            
   1408   f8 00             ldi FCALL.0
   140a   ae                plo FCALL_REG
   140b   de                sep FCALL_REG
                            
   140c   f8 01             ldi NEW_LINE.0  ;print newline
   140e   a6                plo R6
   140f   f8 15             ldi NEW_LINE.1
   1411   b6                phi R6
                        	
   1412   f8 52             ldi PRINT.0     ;prepare to call PRINT
   1414   ad                plo CALL_REG
   1415   f8 01             ldi PRINT.1
   1417   bd                phi CALL_REG
                            
   1418   f8 00             ldi FCALL.0
   141a   ae                plo FCALL_REG
   141b   de                sep FCALL_REG
                            
   141c   8f                glo STACK_REG
   141d   fc 04             adi 4
   141f   af                plo STACK_REG
   1420   9f                ghi STACK_REG
   1421   7c 00             adci 0
   1423   bf                phi STACK_REG
                            
   1424   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-COMMAND-CHECK--------------------------------
                        ;-R4-input string------------------------------
   1425                 COMMAND_CHECK
   1425   f8 35             ldi COMMAND_FUNC_LIST.0
   1427   a5                plo R5
   1428   f8 15             ldi COMMAND_FUNC_LIST.1
   142a   b5                phi R5
                            
   142b   f8 04             ldi COMMAND_LIST.0
   142d   a9                plo R9
   142e   f8 15             ldi COMMAND_LIST.1
   1430   b9                phi R9
                            
   1431   84                glo R4
   1432   a6                plo R6
   1433   94                ghi R4
   1434   b6                phi R6
                            
   1435                 COMMAND_CHECK_GOTOSPACE
   1435   46                lda R6
   1436   c2 14 41          lbz COMMAND_CHECK_INSERTZERO
   1439   fb 20             xri 32
   143b   c2 14 42          lbz COMMAND_CHECK_REPLACESPACE
   143e   c0 14 35          lbr COMMAND_CHECK_GOTOSPACE
                            
   1441                 COMMAND_CHECK_INSERTZERO
   1441   56                str R6
   1442                 COMMAND_CHECK_REPLACESPACE
   1442   26                dec R6
   1443   56                str R6
   1444   16                inc R6
                            
   1445                 COMMAND_CHECK_LOOP
   1445   84                glo R4
   1446   a8                plo R8
   1447   94                ghi R4
   1448   b8                phi R8
                            
   1449   09                ldn R9
   144a   c2 14 72          lbz COMMAND_CHECK_END
                        
   144d   f8 c0             ldi STR_COMPARATOR.0
   144f   ad                plo CALL_REG
   1450   f8 01             ldi STR_COMPARATOR.1
   1452   bd                phi CALL_REG
                            
   1453   f8 00             ldi FCALL.0
   1455   ae                plo FCALL_REG
   1456   de                sep FCALL_REG
                            
   1457   8a                glo R10
   1458   ca 14 65          lbnz COMMAND_CHECK_EXEC
                            
   145b                 COMMAND_CHECK_STR_END
   145b   09                ldn R9
   145c   19                inc R9
   145d   ca 14 5b          lbnz COMMAND_CHECK_STR_END
                            
   1460   15                inc R5
   1461   15                inc R5
   1462   c0 14 45          lbr COMMAND_CHECK_LOOP
                            
   1465                 COMMAND_CHECK_EXEC
   1465   86                glo R6
   1466   a4                plo R4
   1467   96                ghi R6
   1468   b4                phi R4
                            
   1469   45                lda R5
   146a   ad                plo CALL_REG
   146b   05                ldn R5
   146c   bd                phi CALL_REG
                            
   146d   f8 00             ldi FCALL.0
   146f   ae                plo FCALL_REG
   1470   de                sep FCALL_REG
                            
   1471   de                sep RETURN
                            
   1472                 COMMAND_CHECK_END
   1472   f8 41             ldi UNKNOWN_COMMAND.0  ;set the address of the boot msg in R6
   1474   a6                plo R6
   1475   f8 15             ldi UNKNOWN_COMMAND.1
   1477   b6                phi R6
                        	
   1478   f8 52             ldi PRINT.0     ;prepare to call PRINT
   147a   ad                plo CALL_REG
   147b   f8 01             ldi PRINT.1
   147d   bd                phi CALL_REG
                            
   147e   f8 00             ldi FCALL.0
   1480   ae                plo FCALL_REG
   1481   de                sep FCALL_REG   ;call PRINT
                            
   1482   de                sep RETURN
                        ;----------------------------------------------
                        
                        ;-MAIN-----------------------------------------
   1483                 MAIN_PROGRAM
   1483   f8 fe             ldi VAR_LIST_INIT.0       ;variable list init
   1485   ad                plo CALL_REG
   1486   f8 0c             ldi VAR_LIST_INIT.1
   1488   bd                phi CALL_REG
                            
   1489   f8 00             ldi FCALL.0
   148b   ae                plo FCALL_REG
   148c   de                sep FCALL_REG
                            
   148d   f8 50             ldi DYN_MEMORY_INIT.0     ;heap init
   148f   ad                plo CALL_REG
   1490   f8 09             ldi DYN_MEMORY_INIT.1
   1492   bd                phi CALL_REG
                            
   1493   f8 00             ldi FCALL.0
   1495   ae                plo FCALL_REG
   1496   de                sep FCALL_REG   ;call heap init
                            
   1497   f8 da             ldi BOOT_MSG.0  ;set the address of the boot msg in R6
   1499   a6                plo R6
   149a   f8 14             ldi BOOT_MSG.1
   149c   b6                phi R6
                        	
   149d   f8 52             ldi PRINT.0     ;prepare to call PRINT
   149f   ad                plo CALL_REG
   14a0   f8 01             ldi PRINT.1
   14a2   bd                phi CALL_REG
                            
   14a3   f8 00             ldi FCALL.0
   14a5   ae                plo FCALL_REG
   14a6   de                sep FCALL_REG   ;call PRINT
                        
   14a7                 ASK_INPUT
   14a7   f8 00             ldi INPUT_BUFF.0    ;load the address of the buffer to R7
   14a9   a7                plo R7
   14aa   f8 20             ldi INPUT_BUFF.1
   14ac   b7                phi R7
                            
   14ad   f8 68             ldi READLINE.0      ;prepare to call READLINE
   14af   ad                plo CALL_REG
   14b0   f8 01             ldi READLINE.1
   14b2   bd                phi CALL_REG
                            
   14b3   f8 00             ldi FCALL.0
   14b5   ae                plo FCALL_REG
   14b6   de                sep FCALL_REG       ;call READLINE
                            
                            ;Program goes here
   14b7   f8 00             ldi INPUT_BUFF.0
   14b9   a4                plo R4
   14ba   f8 20             ldi INPUT_BUFF.1
   14bc   b4                phi R4
                            
   14bd   f8 25             ldi COMMAND_CHECK.0      ;prepare to call COMMAND_CHECK
   14bf   ad                plo CALL_REG
   14c0   f8 14             ldi COMMAND_CHECK.1
   14c2   bd                phi CALL_REG
                            
   14c3   f8 00             ldi FCALL.0
   14c5   ae                plo FCALL_REG
   14c6   de                sep FCALL_REG
                            ;Program ends here
                            
   14c7   f8 fd             ldi ASK_IN.0        ;load the ASK_IN string's address to R6
   14c9   a6                plo R6
   14ca   f8 14             ldi ASK_IN.1
   14cc   b6                phi R6
                            
   14cd   f8 52             ldi PRINT.0         ;prepare to call PRINT
   14cf   ad                plo CALL_REG
   14d0   f8 01             ldi PRINT.1
   14d2   bd                phi CALL_REG
                            
   14d3   f8 00             ldi FCALL.0
   14d5   ae                plo FCALL_REG
   14d6   de                sep FCALL_REG       ;call PRINT
                        	
   14d7   c0 14 a7          lbr ASK_INPUT
                        ;----------------------------------------------
                        
                        ;-CONSTANT DATA--------------------------------
   14da                 BOOT_MSG
   14da   5a 4c 45 44       db "ZLED - CDP1802 Terminal.\r\n\r\nREADY\r\n"
   14de   20 2d 20 43   
   14e2   44 50 31 38   
   14e6   30 32 20 54   
   14ea   65 72 6d 69   
   14ee   6e 61 6c 2e   
   14f2   0d 0a 0d 0a   
   14f6   52 45 41 44   
   14fa   59 0d 0a      
   14fd                 ASK_IN
   14fd   0d 0a 3e 00       db "\r\n>",0
   1501                 NEW_LINE
   1501   0d 0a 00          db "\r\n",0
   1504                 COMMAND_LIST
   1504   70 72 69 6e       db "print",0,"let",0,"mem_view",0,"mem_debug",0,"mem_alloc",0,"mem_free",0,0
   1508   74 00 6c 65   
   150c   74 00 6d 65   
   1510   6d 5f 76 69   
   1514   65 77 00 6d   
   1518   65 6d 5f 64   
   151c   65 62 75 67   
   1520   00 6d 65 6d   
   1524   5f 61 6c 6c   
   1528   6f 63 00 6d   
   152c   65 6d 5f 66   
   1530   72 65 65 00   
   1534   00            
   1535                 COMMAND_FUNC_LIST
   1535   e4 13             db FUNC_TEST.0,FUNC_TEST.1
   1537   85 0d             db LET_STATEMENT.0,LET_STATEMENT.1
   1539   69 13             db HEXVIEW_CALLER.0,HEXVIEW_CALLER.1
   153b   a8 09             db DYN_MEMORY_DEBUG.0,DYN_MEMORY_DEBUG.1
   153d   ac 11             db DYN_MEMORY_ALLOC_CALLER.0,DYN_MEMORY_ALLOC_CALLER.1
   153f   c7 12             db DYN_MEMORY_FREE_CALLER.0,DYN_MEMORY_FREE_CALLER.1
   1541                 UNKNOWN_COMMAND
   1541   55 6e 6b 6e       db "Unknown command.\r\n",0
   1545   6f 77 6e 20   
   1549   63 6f 6d 6d   
   154d   61 6e 64 2e   
   1551   0d 0a 00      
   1554                 TEST_RESP
   1554   45 76 65 72       db "Everything is ok!",0
   1558   79 74 68 69   
   155c   6e 67 20 69   
   1560   73 20 6f 6b   
   1564   21 00         
                        
   1566                     end
14fd  ASK_IN        14a7  ASK_INPUT     0164  BACKSPACE_ACTION    14da  BOOT_MSG  
000d  CALL_REG      0283  CARRY_SHIFTING    1425  COMMAND_CHECK    1472  COMMAND_CHECK_END
1465  COMMAND_CHECK_EXEC    1435  COMMAND_CHECK_GOTOSPACE    1441  COMMAND_CHECK_INSERTZERO    1445  COMMAND_CHECK_LOOP
1442  COMMAND_CHECK_REPLACESPACE    145b  COMMAND_CHECK_STR_END    1535  COMMAND_FUNC_LIST    1504  COMMAND_LIST
028d  DIVISION_LOOP    3000  DMA_ADDRESS    0013  DMA_INIT      0000  DMA_REG   
0ae7  DYN_MEMORY_ALLOC    11ac  DYN_MEMORY_ALLOC_CALLER    125e  DYN_MEMORY_ALLOC_CALLER_END    11e1  DYN_MEMORY_ALLOC_CALLER_FAIL
1164  DYN_MEMORY_ALLOC_CALLER_STR1    119b  DYN_MEMORY_ALLOC_CALLER_STR2    11f4  DYN_MEMORY_ALLOC_CALLER_SUCCESS    0c30  DYN_MEMORY_ALLOC_END
0b23  DYN_MEMORY_ALLOC_MAINLOOP    0bfb  DYN_MEMORY_ALLOC_NEXTADDRESS    0c15  DYN_MEMORY_ALLOC_NEXTPASS    0b70  DYN_MEMORY_ALLOC_SIZEBIGGER
0b5d  DYN_MEMORY_ALLOC_SIZEEQ    09a8  DYN_MEMORY_DEBUG    0ade  DYN_MEMORY_DEBUG_END    0aa3  DYN_MEMORY_DEBUG_FREE
09c2  DYN_MEMORY_DEBUG_MAINLOOP    0aa9  DYN_MEMORY_DEBUG_NEXTADDRESS    0a05  DYN_MEMORY_DEBUG_PRINT    0973  DYN_MEMORY_DEBUG_STR
099a  DYN_MEMORY_DEBUG_STR_FREE    09a1  DYN_MEMORY_DEBUG_STR_USED    0c4a  DYN_MEMORY_FREE    12c7  DYN_MEMORY_FREE_CALLER
1360  DYN_MEMORY_FREE_CALLER_END    1350  DYN_MEMORY_FREE_CALLER_OUTOFRANGE    1267  DYN_MEMORY_FREE_CALLER_STR1    129c  DYN_MEMORY_FREE_CALLER_STR2
0ce1  DYN_MEMORY_FREE_END    0c82  DYN_MEMORY_FREE_MERGE    0ca2  DYN_MEMORY_FREE_MERGELOOP    0c73  DYN_MEMORY_FREE_NEXTCHECK
0cda  DYN_MEMORY_FREE_SETPREVIOUS    0950  DYN_MEMORY_INIT    017a  END_LINE      0855  EXPRESSION
088a  EXPRESSION_ADD    08c4  EXPRESSION_ADD_LOOP    093f  EXPRESSION_END    0876  EXPRESSION_MAIN
093b  EXPRESSION_NEXT_CYCLE    0866  EXPRESSION_SKIPSPACES    08e3  EXPRESSION_SUB    091d  EXPRESSION_SUB_LOOP
06b0  FACTOR        072f  FACTOR_END    0755  FACTOR_FINAL    074a  FACTOR_INVERTING
06bc  FACTOR_MAIN    0720  FACTOR_NEGATE    072b  FACTOR_NEXT_CYCLE    0706  FACTOR_PARENTHESIS
0711  FACTOR_PARENTHESIS_SKIPSPACES    06eb  FACTOR_READ_DEC    06f8  FACTOR_READ_HEX    0100  FCALL     
000e  FCALL_REG     031f  FINAL_CHECK    0343  FINAL_CHECK2    010a  FRETURN   
13e4  FUNC_TEST     0d10  GET_STRING    0d43  GET_STRING_ADDLEN    0d4d  GET_STRING_ALLOCATE_MEM
0d62  GET_STRING_COPY    0d6f  GET_STRING_COPY_LOOP    0d79  GET_STRING_END    0d23  GET_STRING_LEN
0d47  GET_STRING_LEN_END    fc00  HEAP_END      2106  HEAP_LASTADDRESS    2110  HEAP_START
0f1e  HEXVIEWER     115b  HEXVIEWER_END    0f95  HEXVIEWER_MAINLOOP    1011  HEXVIEWER_NEXT_HEX
10d0  HEXVIEWER_NEXT_STR    0fbd  HEXVIEWER_PRINT_HEX_LOOP    1001  HEXVIEWER_PRINT_HEX_SPACES    10b4  HEXVIEWER_PRINT_STR_DOT
1071  HEXVIEWER_PRINT_STR_LOOP    10c3  HEXVIEWER_PRINT_STR_SPACE    1369  HEXVIEW_CALLER    13d2  HEXVIEW_CALLER_END
13b3  HEXVIEW_CALLER_EXEC    13a4  HEXVIEW_CALLER_NEXTARG    0e75  HEX_BASE_SRT    0412  HEX_CHARS 
0e88  HEX_HEADER_STR    0f19  HEX_LINECNT_SEPARATOR    2000  INPUT_BUFF    01d4  INTEGER_DIV
0224  INTEGER_DIV_INVERT_LOOP1    0234  INTEGER_DIV_NEXT_CHECK    0372  INTEGER_MUL    03d3  INTEGER_MUL_ADD
0409  INTEGER_MUL_END    039f  INTEGER_MUL_LOOP    03dc  INTEGER_MUL_SHIFT    03fd  INTEGER_MUL_SHMULTIPLICAND
03e9  INTEGER_MUL_SHMULTIPLIER    0262  INTEGER_SHIFT_DR    0001  INTP_REG      0002  INTX_REG  
0253  INVERT_LOOP2    0337  INVERT_LOOP3    035e  INVERT_LOOP4    0d85  LET_STATEMENT
0e14  LET_STATEMENT_ADDNODE    0e05  LET_STATEMENT_ADDVAR    0daf  LET_STATEMENT_CONTINUE1    0dd5  LET_STATEMENT_CONTINUE2
0e5f  LET_STATEMENT_END    0dfa  LET_STATEMENT_EXPRESSION    0e34  LET_STATEMENT_FIRSTNODE    0e4f  LET_STATEMENT_FREENODE
0dea  LET_STATEMENT_MAINLOOP    0df7  LET_STATEMENT_NEXTCHARACTER    0dbe  LET_STATEMENT_SKIPSPACES    1483  MAIN_PROGRAM
1501  NEW_LINE      0307  NEXT_BIT      0003  PC_REG        0152  PRINT     
045e  PRINT_CHECK_DIGIT    04ae  PRINT_DEC     0555  PRINT_DEC_END    055e  PRINT_DEC_FINAL
0502  PRINT_DEC_INVER_LOOP    050d  PRINT_DEC_MAIN_LOOP    0461  PRINT_DIGIT_LOOP    0422  PRINT_HEX 
048f  PRINT_HEX_END    0473  PRINT_HEX_SHIFT_LOOP1    0449  PRINT_UNTIL_R    000a  R10       
000b  R11           000c  R12           0004  R4            0005  R5        
0006  R6            0007  R7            0008  R8            0009  R9        
0168  READLINE      018e  READLINE_BACKSPACE    016b  READLINE_LOOP    058b  READ_DEC  
061c  READ_DEC_END    05a5  READ_DEC_MAIN_LOOP    062e  READ_HEX      066a  READ_HEX_CONTINUE
069e  READ_HEX_END    068d  READ_HEX_HEXDIGIT    0696  READ_HEX_HEXDIGITLOWER    064b  READ_HEX_MAINLOOP
0699  READ_HEX_NEXTCHAR    066d  READ_HEX_SHIFTLOOP    000e  RETURN        013f  SERIAL_NULL_BIT
012d  SERIAL_READ_START    0139  SERIAL_SAMPLE_BIT    0143  SERIAL_SAVE_BIT    011b  SERIAL_SEND_BIT
0113  SERIAL_SEND_START    0131  SERIAL_WAIT_START    02a5  SHIFTING_Q    0276  SHIFT_DR  
0314  SHIFT_SUBTRACTOR    ffff  STACK_ADDRESS    000f  STACK_REG     0000  START     
01aa  STORE_CHAR    01c3  STR_CHARCHECK    01c0  STR_COMPARATOR    01c9  STR_EQUAL 
01d0  STR_INC       02fd  SUBTRACT_FOR_REAL    075e  TERM          0785  TERM_DIVIDE
0843  TERM_END      0771  TERM_MAIN     07ea  TERM_MULTIPLY    083f  TERM_NEXT_CYCLE
1554  TEST_RESP     13db  TEST_STR1     0369  THE_END       02c7  TRY_SUBTRACTING
1541  UNKNOWN_COMMAND    2100  VARLIST_COUNT    2102  VARLIST_FIRSTNODE    2104  VARLIST_LASTNODE
0cfe  VAR_LIST_INIT    0d07  VAR_LIST_INIT_LOOP    
